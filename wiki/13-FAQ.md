# 13 FAQ 与故障排查

汇总常见使用 / 运行 / 配置问题与排查路径，帮助快速定位问题根因。

---
## 1. 基础运行

### Q1: 程序启动但热键无效？
A: 需要管理员权限；确认未被其他软件（录屏/键鼠驱动）拦截；查看日志是否注册失败。

### Q2: GUI 卡住或无响应？
A: 检查是否在主线程执行了阻塞操作；避免在槽函数里做大循环；必要时放入线程池。

### Q3: 为什么需要 Windows 平台？
A: 底层使用 Windows Graphics Capture 和 Windows API 热键 / 消息机制；其它平台未适配。

---
## 2. 屏幕捕获 & 图像

### Q4: Debug OSD 一直停在 READY？
A: RUNNING 前没有产生技能或动作数据属正常；进入 RUNNING 产生事件后会切换。若已 RUNNING，检查 DebugDisplayManager 是否 `is_active`。

### Q5: 冷却技能总是“未就绪”？
A: 可能坐标/Size 错误或图标包含动态效果；尝试缩小 Size 或重新定位中心点；查看日志是否低于相似度阈值。

### Q6: 药剂检测不触发？
A: HSV 颜色不准确或 threshold 过低；重新使用拾色器；检查内部冷却是否未结束；确认 region 覆盖了药剂条主体。 

### Q7: 资源百分比跳动剧烈？
A: 背景像素噪声或界面闪烁；增大容差并启用连续窗口；或缩小检测区域。

---
## 3. 技能与输入

### Q8: 高优先级技能似乎没有抢占？
A: 仅在入队阶段插入队头；若队列瞬时为空无差异；确认 Priority 字段为 true。

### Q9: 按住技能没有释放？
A: 检查 STOPPED/PAUSED 状态是否正常触发；日志中应看到 release；若没有可能未收集按住列表或 AHK 连接失败。

### Q10: dry_run 模式下仍真实按键？
A: 构造 InputHandler 时 dry_run 标志未传递；或单独直接调用了底层发送函数。

---
## 4. 调试 & 日志

### Q11: 如何启用更详细日志？
A: 设置系统环境变量 `DEBUG=1` 后重新启动；或在启动脚本前临时 `set DEBUG=1`（Windows）。

### Q12: 日志太多影响性能？
A: 限制在 DEBUG 模式使用；高频路径避免格式化长字符串；必要时添加按级别过滤。

---
## 5. 寻路 / 洗练

### Q13: 寻路不移动？
A: 小地图 ROI 解析失败或未启用模式；确认 F9→READY→Z→RUNNING 顺序；检查 StepDistance 是否过小。

### Q14: A* 路径异常 zigzag？
A: 地图拼接中断导致缺口；检查相位相关偏移日志；或对探索算法进行闭运算参数调整。

### Q15: 洗练 OCR 识别慢？
A: PaddleOCR 首次加载耗时正常；可预热；减少截图区域；关闭不必要功能降低系统压力。

---
## 6. 性能与资源

### Q16: CPU 占用高？
A: 过多 <100ms 间隔任务；调大间隔；复用帧；关闭调试发布；减少日志。

### Q17: 内存上升持续不降？
A: 模板缓存或全局地图过大；定期清理、限制历史帧；确认未意外复制 numpy 数组。

### Q18: 延迟高/卡顿？
A: UI 线程被阻塞；避免在回调中做重计算；必要时拆分线程或延后处理。

---
## 7. 扩展与二次开发

### Q19: 如何新增一个新的条件类型？
A: 在 `_evaluate_condition` 中添加分支；实现私有方法；更新文档 12；调整配置解析。

### Q20: 如何添加新的 OSD 字段？
A: DebugDisplayManager 收集 + 发布 → DebugOsdWindow 解析 → UI 标签追加。注意性能与刷新频率。

---
## 8. 兼容性

### Q21: 多显示器支持吗？
A: 当前以主显示获取；若游戏在副屏可能需要扩展捕获接口指定 HWND 或显示器索引。

### Q22: DPI 缩放影响吗？
A: 高 DPI 下坐标可能偏移；建议使用 100% 缩放或在捕获时做 DPI 适配。

---
## 9. 快速自检清单
- [ ] F8 → READY 日志出现且保存 debug_frame
- [ ] READY 后技能/药剂模板存在（无异常日志）
- [ ] RUNNING 仅存在期望频率任务（scheduler dump）
- [ ] Debug OSD 更新包含技能行与动作行
- [ ] 暂停后 OSD 停止变化但保留最后帧
- [ ] STOPPED 后所有 hold 技能释放

---
## 10. 反馈与支持
- 建议通过 Issue/PR 形式提交：包含说明、复现步骤、期望行为、日志片段
- 贡献前查看 08 开发指南

---
本章完。返回目录：`README` 或继续阅读其他章节。
