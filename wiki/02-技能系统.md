# 技能系统

## 概述

技能系统是pyahk的核心功能，提供自动化的技能释放、冷却检测和优先级管理。支持多种触发模式和执行条件，实现精确的战斗自动化。

## 技能触发模式

### 1. 定时模式 (TriggerMode = 0)
- **功能**：基于固定时间间隔执行技能
- **配置参数**：`Timer` - 执行间隔（毫秒）
- **使用场景**：持续BUFF技能、定期回血技能等
- **执行特点**：严格按时间间隔执行，不受游戏状态影响

### 2. 冷却模式 (TriggerMode = 1)
- **功能**：基于技能图标冷却状态执行技能
- **配置参数**：
  - `CooldownCoordX/Y` - 技能图标坐标
  - `CooldownSize` - 检测区域大小
- **检测原理**：通过RGB图像匹配检测技能是否可用
- **使用场景**：主要输出技能、有冷却时间的关键技能

### 3. 按住模式 (TriggerMode = 2)
- **功能**：进入运行状态时按下，停止时释放
- **执行特点**：
  - 仅在状态切换时一次性执行
  - 不参与循环或定时任务
  - 由AHK服务执行，支持组合键
- **使用场景**：持续技能、移动速度增强等

## 技能优先级系统

### 双重优先级机制
- **检查优先级**：高优先级技能在冷却检测时优先检查
- **队列优先级**：高优先级技能按键插入队列前端，确保立即执行

### 配置方式
```json
{
  "Priority": true,  // 设置为高优先级
  "TriggerMode": 1,  // 冷却模式
  "Key": "q"
}
```

### 应用场景
- 核心输出技能设为高优先级
- 紧急恢复技能设为高优先级
- 确保关键技能在复杂战斗中优先释放

## 执行条件系统

### 无条件模式 (ExecuteCondition = 0)
- 冷却就绪时直接执行主按键
- 最简单的执行模式

### Buff限制模式 (ExecuteCondition = 1)
- **检测逻辑**：检查指定位置的buff状态
- **执行逻辑**：
  - Buff存在 → 不执行按键
  - Buff不存在 → 执行主按键
- **使用场景**：避免重复上BUFF

### 资源条件模式 (ExecuteCondition = 2)
- **检测逻辑**：检查资源是否充足（MP、怒气等）
- **执行逻辑**：
  - 资源充足 → 执行主按键
  - 资源不足 → 执行备用按键 (AltKey)
- **连续性检查**：避免检测抖动，确保稳定执行
- **使用场景**：根据资源状态切换技能

## 检测方法

### RGB相似度检测
```python
# 用于技能冷却和特定颜色buff检测
def rgb_similarity(frame, x, y, target_color, tolerance):
    # 检查RGB颜色差异是否在容差范围内
```

### 资源充足检测
```python
# 用于MP/能量等资源检测
def is_resource_sufficient(frame, x, y, threshold):
    # 检查颜色范围差异判断资源状态
```

### HP检测
```python
# 专门用于红色HP条检测
def is_hp_sufficient(frame, x, y):
    # 检查是否为红色HP条颜色
```

## 序列模式

### 功能特点
- 按预设顺序循环执行多个技能
- 不依赖技能冷却状态
- 适用于固定的技能循环

### 配置方式
```json
{
  "sequence_enabled": true,
  "skill_sequence": "q,w,e,r",
  "sequence_timer_interval": 800
}
```

## 技能配置示例

### 定时BUFF技能
```json
{
  "技能名称": {
    "Enabled": true,
    "Priority": false,
    "TriggerMode": 0,
    "Timer": 5000,
    "Key": "4",
    "ExecuteCondition": 1,
    "ConditionCoordX": 100,
    "ConditionCoordY": 200,
    "ConditionColor": 16777215,
    "ColorTolerance": 15
  }
}
```

### 高优先级输出技能
```json
{
  "主要输出": {
    "Enabled": true,
    "Priority": true,
    "TriggerMode": 1,
    "CooldownCoordX": 960,
    "CooldownCoordY": 850,
    "CooldownSize": 15,
    "Key": "q",
    "ExecuteCondition": 0
  }
}
```

### 资源条件技能
```json
{
  "消耗技能": {
    "Enabled": true,
    "Priority": false,
    "TriggerMode": 1,
    "CooldownCoordX": 1000,
    "CooldownCoordY": 850,
    "Key": "w",
    "AltKey": "e",
    "ExecuteCondition": 2,
    "ConditionCoordX": 1550,
    "ConditionCoordY": 950,
    "ConditionColor": 0,
    "ColorTolerance": 100
  }
}
```

## 使用技巧

1. **技能优先级**：将核心输出技能设为高优先级
2. **冷却检测**：确保坐标准确，可使用截图工具确认
3. **条件设置**：根据实际游戏界面调整坐标和颜色
4. **按住技能**：需要启动hold_server.ahk服务
5. **性能优化**：避免设置过多高频技能