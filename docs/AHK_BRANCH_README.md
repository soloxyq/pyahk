# feature/ahk-input-system 分支说明

## 🎯 分支目标

**将整个输入系统迁移到AHK，实现Python决策、AHK执行的架构**

## 📊 当前状态

- ✅ 架构设计完成
- ✅ 实施计划完成
- ✅ 性能测试完成（0.069ms延迟）
- ⏳ 代码实施中...

## 🏗️ 架构变化

### 之前（存在问题）
```
Python
  ├─ 图像检测 ✓
  ├─ 条件判断 ✓
  ├─ Hook拦截 ✗ (自拦截问题)
  ├─ 按键队列 ✓
  └─ 输入执行 ✗ (游戏兼容性问题)
```

### 之后（完美解决）
```
Python                          AHK
  ├─ 图像检测 ✓                  
  ├─ 条件判断 ✓                  
  └─ 发送命令 ──WM_COPYDATA──> ├─ Hook拦截 ✓ (无自拦截)
                                ├─ 按键队列 ✓ (精确时序)
                                └─ 输入执行 ✓ (完美兼容)
```

## 📋 核心原则

1. **简单、直接、纯粹**
   - 全面使用AHK，不搞降级
   - 遇到问题就解决，不绕路
   - 保持代码简洁，不增加复杂度

2. **职责清晰**
   - Python：图像检测、条件判断、策略决策
   - AHK：Hook拦截、按键队列、输入执行

3. **性能优秀**
   - 通信延迟：0.069ms（实测）
   - 队列处理：10ms周期
   - 总体影响：<1%

## 📚 文档索引

1. **[AHK_COMPLETE_ARCHITECTURE.md](./AHK_COMPLETE_ARCHITECTURE.md)**
   - 完整的架构设计
   - 详细的技术方案
   - 通信协议定义

2. **[AHK_IMPLEMENTATION_PLAN.md](./AHK_IMPLEMENTATION_PLAN.md)**
   - 详细的实施计划（9-13天）
   - 任务分解和验收标准
   - 进度跟踪表

3. **[AHK_SIMPLE_PLAN.md](./AHK_SIMPLE_PLAN.md)** ⭐ 推荐
   - 简洁的实施方案（6天）
   - 核心代码结构
   - 迁移清单

## 🚀 快速开始

### 查看设计
```bash
# 查看简洁方案（推荐）
cat docs/AHK_SIMPLE_PLAN.md

# 查看完整架构
cat docs/AHK_COMPLETE_ARCHITECTURE.md
```

### 开始实施
```bash
# 第一步：创建AHK服务器
# 参考 docs/AHK_SIMPLE_PLAN.md 中的代码

# 第二步：创建Python组件
# 参考 docs/AHK_SIMPLE_PLAN.md 中的代码

# 第三步：删除旧代码
# 参考迁移清单
```

## 🎯 预期收益

### 功能收益
- ✅ 彻底解决Hook自拦截问题
- ✅ 更精确的时序控制（10ms队列处理）
- ✅ 解决技能前后摇问题
- ✅ 更好的游戏兼容性
- ✅ 简化Python代码

### 性能影响
- 通信延迟：+0.069ms
- 占检测周期：<0.5%
- **结论**：性能影响可忽略

### 代码质量
- ✅ 职责更清晰
- ✅ 代码更简洁
- ✅ 易于维护
- ✅ 易于扩展

## 📊 实施进度

| 阶段 | 任务 | 状态 | 预计时间 |
|------|------|------|----------|
| 设计 | 架构设计 | ✅ 完成 | - |
| 设计 | 实施计划 | ✅ 完成 | - |
| 设计 | 性能测试 | ✅ 完成 | - |
| 实施 | AHK Server | ⏳ 进行中 | 2天 |
| 实施 | Python组件 | ⏳ 待开始 | 1天 |
| 实施 | 删除旧代码 | ⏳ 待开始 | 1天 |
| 测试 | 功能测试 | ⏳ 待开始 | 1天 |
| 测试 | 性能测试 | ⏳ 待开始 | 0.5天 |
| 文档 | 更新文档 | ⏳ 待开始 | 0.5天 |

**总工期**：6天

## 🔍 关键决策

### 1. 事件通信方式：文件
- AHK写入 `ahk_events.txt`
- Python监控文件变化
- 延迟<10ms，简单可靠

### 2. 不做降级方案
- AHK不可用就报错
- 提示用户安装/启动AHK
- 不增加代码复杂度

### 3. 不做兼容保留
- 直接替换旧代码
- 不保留旧的InputHandler
- 彻底迁移

## 💡 下一步行动

1. **立即开始**：实施 `hold_server_extended.ahk`
2. **参考文档**：`docs/AHK_SIMPLE_PLAN.md`
3. **每日提交**：保持代码同步

## 📞 联系方式

- **分支**：feature/ahk-input-system
- **创建时间**：2025-10-15
- **预计完成**：2025-10-21

---

**让我们开始吧！🚀**
