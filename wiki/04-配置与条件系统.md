# 04 é…ç½®ä¸æ¡ä»¶ç³»ç»Ÿ

## æ¦‚è¿°

é…ç½®ç³»ç»Ÿæ˜¯pyahkçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œæä¾›çµæ´»çš„JSONé…ç½®ç®¡ç†å’Œå¼ºå¤§çš„æ¡ä»¶é€»è¾‘ç³»ç»Ÿã€‚æ”¯æŒçƒ­é‡è½½ã€é…ç½®éªŒè¯å’Œå¤šé…ç½®æ–‡ä»¶ç®¡ç†ï¼Œä¸ºå¤æ‚çš„æ¸¸æˆè‡ªåŠ¨åŒ–éœ€æ±‚æä¾›ç²¾ç¡®çš„æ§åˆ¶èƒ½åŠ›ã€‚

---

## ğŸ“‹ é…ç½®ç®¡ç†æ¶æ„

### ConfigManager æ ¸å¿ƒåŠŸèƒ½
```python
class ConfigManager:
    """ç»Ÿä¸€é…ç½®ç®¡ç†å™¨"""
    def __init__(self):
        self._configs = {}
        self._watchers = {}
        self._schema_validator = None
    
    def load_config(self, config_file: str) -> dict:
        """åŠ è½½å¹¶éªŒè¯é…ç½®æ–‡ä»¶"""
        
    def save_config(self, config_file: str, config_data: dict):
        """ä¿å­˜é…ç½®åˆ°æ–‡ä»¶"""
        
    def hot_reload(self, config_file: str):
        """çƒ­é‡è½½é…ç½®ï¼Œæ— éœ€é‡å¯ç¨‹åº"""
```

### é…ç½®æ–‡ä»¶ç»“æ„
```json
{
  "version": "1.0",
  "global": {
    "debug_mode": false,
    "capture_interval": 100,
    "log_level": "INFO"
  },
  "skills": [
    {
      "name": "ä¸»è¦æŠ€èƒ½",
      "key": "1",
      "trigger_mode": 1,
      "execute_condition": 2,
      "priority": "high",
      "enabled": true
    }
  ],
  "resource_management": {
    "hp_config": {
      "enabled": true,
      "key": "1",
      "threshold": 50,
      "center_x": 175,
      "center_y": 957,
      "radius": 39,
      "colors": [
        {
          "name": "HP Normal",
          "target_h": 157,
          "target_s": 75,
          "target_v": 29,
          "tolerance_h": 5,
          "tolerance_s": 20,
          "tolerance_v": 20
        }
      ]
    },
    "mp_config": {
      "enabled": true,
      "key": "2",
      "threshold": 50,
      "center_x": 175,
      "center_y": 957,
      "radius": 39,
      "colors": [...]
    },
    "check_interval": 200
  },
  "priority_keys": {
    "enabled": true,
    "keys": ["space", "right_mouse"]
  },
  "pathfinding": {
    "enabled": false,
    "minimap_region": [1670, 50, 200, 200],
    "exploration_mode": "systematic"
  },
  "affix_reroll": {
    "enabled": false,
    "target_affixes": ["æš´å‡»ç‡", "æš´å‡»ä¼¤å®³"],
    "max_attempts": 100
  }
}
```

### é…ç½®éªŒè¯ä¸ç±»å‹æ£€æŸ¥
```python
from pydantic import BaseModel, Field
from typing import List, Optional, Tuple

class SkillConfig(BaseModel):
    name: str
    key: str                          # ä¸»è¦æŒ‰é”® - æ”¯æŒåºåˆ—æ ¼å¼
    alt_key: Optional[str] = None     # è¾…åŠ©æŒ‰é”® - æ”¯æŒåºåˆ—æ ¼å¼
    trigger_mode: int = Field(ge=0, le=2)
    execute_condition: int = Field(ge=0, le=2)
    priority: bool = False
    enabled: bool = True
    interval: Optional[int] = Field(None, ge=50)
    cooldown_coords: Optional[List[int]] = None

class PriorityKeysConfig(BaseModel):
    enabled: bool = True
    keys: List[str] = []
    delay_ms: int = Field(50, ge=0, le=1000)  # ä¼˜å…ˆçº§å»¶è¿Ÿä¿æŠ¤

class GlobalConfig(BaseModel):
    debug_mode: bool = False
    capture_interval: int = Field(100, ge=50, le=1000)
    log_level: str = Field("INFO", regex="^(DEBUG|INFO|WARNING|ERROR)$")
```

### ğŸš€ æŒ‰é”®åºåˆ—é…ç½®

#### åºåˆ—æ ¼å¼æ”¯æŒ
```json
{
  "name": "ç«çƒè¿å‡»",
  "key": "delay50,q",              // å»¶è¿Ÿ50msåæŒ‰qé”®
  "alt_key": "delay100,shift+q",   // å»¶è¿Ÿ100msåæŒ‰ç»„åˆé”®
  "trigger_mode": 0,
  "interval": 2000
}
```

#### å¤æ‚åºåˆ—ç¤ºä¾‹
```json
{
  "name": "ä¸‰è¿å‡»æŠ€èƒ½",
  "key": "1,delay200,2,delay150,3",    // è¿ç»­æŠ€èƒ½é‡Šæ”¾
  "alt_key": "delay100,ctrl+1",        // å¼ºåŒ–ç‰ˆæœ¬
  "trigger_mode": 1,                   // å†·å´è§¦å‘
  "cooldown_coords": [100, 50, 20, 20]
}
```

#### åºåˆ—éªŒè¯è§„åˆ™
```python
def validate_key_sequence(key_sequence: str) -> bool:
    """éªŒè¯æŒ‰é”®åºåˆ—æ ¼å¼"""
    if not key_sequence:
        return False
    
    # æ”¯æŒå•ä¸ªæŒ‰é”®æˆ–é€—å·åˆ†éš”çš„åºåˆ—
    if ',' not in key_sequence:
        return validate_single_key(key_sequence)
    
    # éªŒè¯åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ 
    for key_part in key_sequence.split(','):
        key_part = key_part.strip()
        if key_part.startswith('delay'):
            # éªŒè¯å»¶è¿Ÿæ ¼å¼ï¼šdelay50, delay100, etc.
            try:
                delay_ms = int(key_part[5:])
                if delay_ms < 0 or delay_ms > 10000:
                    return False
            except ValueError:
                return False
        else:
            if not validate_single_key(key_part):
                return False
    return True
```
```

### é…ç½®çƒ­é‡è½½æœºåˆ¶
```python
class ConfigWatcher:
    """é…ç½®æ–‡ä»¶å˜åŒ–ç›‘æ§"""
    def __init__(self, config_manager):
        self.config_manager = config_manager
        self.file_watchers = {}
    
    def watch_config_file(self, config_file: str):
        """ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨é‡è½½"""
        from watchdog.observers import Observer
        from watchdog.events import FileSystemEventHandler
        
        class ConfigFileHandler(FileSystemEventHandler):
            def on_modified(self, event):
                if event.src_path.endswith('.json'):
                    self.config_manager.hot_reload(event.src_path)
```

---

## ğŸ¯ æ¡ä»¶ç³»ç»Ÿè¯¦è§£

### è®¾è®¡ç›®æ ‡
- **ç®€å•å¯æšä¸¾**ï¼šä½¿ç”¨æ•´å‹æšä¸¾å€¼ 0/1/2 æ§åˆ¶åˆ†æ”¯
- **æ‰©å±•å‹å¥½**ï¼šæ–°å¢æ¡ä»¶æ—¶åªéœ€å¢åŠ æšä¸¾ + `_evaluate_condition` åˆ†æ”¯
- **ç¨³å®šé˜²æŠ–**ï¼šèµ„æºæ¡ä»¶åŠ å…¥è¿ç»­çª—å£ï¼Œé¿å…è¾¹ç•ŒæŠ–åŠ¨

### æ¡ä»¶æšä¸¾æ¦‚è§ˆ

| å€¼ | åç§° | è¯­ä¹‰ | é€‚ç”¨åœºæ™¯ |
|----|------|------|----------|
| 0 | æ— æ¡ä»¶ | ç›´æ¥å…è®¸æ‰§è¡Œ | æ™®é€šå¾ªç¯æŠ€èƒ½ |
| 1 | BUFF é™åˆ¶ | ä»…å½“æŒ‡å®š Buff ä¸å­˜åœ¨/å¤±æ•ˆæ—¶æ‰§è¡Œ | ç»´æŒç±»æŠ€èƒ½ã€éœ€åˆ·æ–°çŠ¶æ€ |
| 2 | èµ„æºæ¡ä»¶ | èµ„æºè¾¾åˆ°é˜ˆå€¼ä¸”åœ¨è¿ç»­çª—å£å†…ç¨³å®š | èµ„æºé©±åŠ¨çˆ†å‘/æ¶ˆè€—ç±» |

### æ‰§è¡Œè°ƒç”¨æ ˆ
```python
def _try_execute_skill(skill):
    """æŠ€èƒ½æ‰§è¡Œå…¥å£"""
    if not skill.enabled:
        return False
    
    if not self._check_execution_conditions(skill):
        return False
    
    return self._execute_skill_action(skill)

def _check_execution_conditions(skill):
    """æ¡ä»¶æ£€æŸ¥åˆ†å‘å™¨"""
    condition = skill.execute_condition
    
    if condition == 0:
        return True  # æ— æ¡ä»¶
    elif condition == 1:
        return self._evaluate_condition_buff(skill)
    elif condition == 2:
        return self._evaluate_condition_resource(skill)
    else:
        LOG_ERROR(f"æœªçŸ¥çš„æ‰§è¡Œæ¡ä»¶: {condition}")
        return False
```

### æ— æ¡ä»¶æ¨¡å¼ (ExecuteCondition = 0)
```json
{
  "name": "åŸºç¡€æ”»å‡»",
  "key": "1",
  "trigger_mode": 1,
  "execute_condition": 0,
  "cooldown_coords": [100, 50, 20, 20]
}
```
- **è¡Œä¸º**ï¼šå†·å´å°±ç»ªæ—¶ç›´æ¥æ‰§è¡Œä¸»æŒ‰é”®
- **é€‚ç”¨**ï¼šæ— ç‰¹æ®Šé™åˆ¶çš„å¸¸è§„æŠ€èƒ½
- **ä¼˜åŠ¿**ï¼šç®€å•ç›´æ¥ï¼Œæ€§èƒ½æœ€é«˜

### Buffé™åˆ¶æ¨¡å¼ (ExecuteCondition = 1)
```json
{
  "name": "æŠ¤ç›¾æŠ€èƒ½",
  "key": "e",
  "trigger_mode": 1,
  "execute_condition": 1,
  "buff_coords": [200, 100, 30, 30],
  "buff_color": [100, 150, 200],
  "buff_tolerance": 20
}
```

#### æ£€æµ‹é€»è¾‘
```python
def _evaluate_condition_buff(self, skill):
    """Buffå­˜åœ¨æ€§æ£€æµ‹"""
    if not skill.buff_coords:
        return True
    
    frame = self.border_manager.get_current_frame()
    if frame is None:
        return False
    
    x, y, w, h = skill.buff_coords
    roi = frame[y:y+h, x:x+w]
    
    # RGBé¢œè‰²åŒ¹é…æ£€æµ‹Buffå›¾æ ‡
    target_color = skill.buff_color
    tolerance = skill.buff_tolerance or 20
    
    similarity = self._calculate_color_similarity(roi, target_color)
    buff_exists = similarity > 0.8  # 80%ç›¸ä¼¼åº¦é˜ˆå€¼
    
    # Buffå­˜åœ¨æ—¶ä¸æ‰§è¡Œï¼Œä¸å­˜åœ¨æ—¶æ‰§è¡Œ
    return not buff_exists
```

#### åº”ç”¨åœºæ™¯
- **æŠ¤ç›¾æŠ€èƒ½**ï¼šæŠ¤ç›¾æ¶ˆå¤±æ—¶è‡ªåŠ¨é‡æ–°æ–½æ”¾
- **å¢ç›ŠBUFF**ï¼šBUFFåˆ°æœŸæ—¶è‡ªåŠ¨åˆ·æ–°
- **çŠ¶æ€ç»´æŒ**ï¼šç¡®ä¿å…³é”®çŠ¶æ€æŒç»­å­˜åœ¨

### èµ„æºæ¡ä»¶æ¨¡å¼ (ExecuteCondition = 2)
```json
{
  "name": "æ¶ˆè€—æŠ€èƒ½",
  "key": "r",
  "trigger_mode": 1,
  "execute_condition": 2,
  "condition_coord_x": 50,
  "condition_coord_y": 950,
  "condition_color": 0,  // 0=èµ„æºæ£€æµ‹, 1=HPæ£€æµ‹, å…¶ä»–=RGBé¢œè‰²åŒ¹é…
  "color_tolerance": 12,
  "alt_key": "t"
}
```

#### ğŸš€ äºŒæ¬¡ç¡®è®¤æœºåˆ¶ (æœ€æ–°æ¶æ„)
  èµ„æºæ¡ä»¶æ£€æµ‹é‡‡ç”¨æ™ºèƒ½çš„è¿ç»­æ€§éªŒè¯æœºåˆ¶ï¼Œç¡®ä¿æ£€æµ‹ç»“æœçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å®é™…ä»£ç ä¸­å®ç°äº†æ»‘åŠ¨çª—å£æ£€æµ‹ï¼Œé¿å…è¾¹ç•ŒæŠ–åŠ¨ï¼š

```python
def _check_resource_continuity(self, skill_name: str, current_result: bool) -> bool:
    """
    èµ„æºæ¡ä»¶è¿ç»­æ€§æ£€æŸ¥ - æ™ºèƒ½äºŒæ¬¡ç¡®è®¤æœºåˆ¶
    - å¦‚æœå½“å‰ç»“æœä¸ºTrueï¼ˆèµ„æºå……è¶³ï¼‰ï¼Œéœ€è¦è¿ç»­å¤šæ¬¡Trueæ‰æ‰§è¡Œä¸»æŒ‰é”®
    - å¦‚æœå½“å‰ç»“æœä¸ºFalseï¼ˆèµ„æºä¸è¶³ï¼‰ï¼Œç«‹å³æ‰§è¡Œå¤‡ç”¨æŒ‰é”®
    """
    history = self._resource_condition_history.setdefault(skill_name, [])
    history.append(current_result)
    if len(history) > self._required_consecutive_checks:  # é»˜è®¤ä¸º2
        history.pop(0)

    # å¦‚æœå½“å‰ç»“æœä¸ºFalseï¼ˆèµ„æºä¸è¶³ï¼‰ï¼Œç«‹å³è¿”å›Falseæ‰§è¡ŒAltKey
    if not current_result:
        return False

    # å¦‚æœå½“å‰ç»“æœä¸ºTrueï¼ˆèµ„æºå……è¶³ï¼‰ï¼Œéœ€è¦è¿ç»­å¤šæ¬¡Trueæ‰è¿”å›True
    if all(history) and len(history) == self._required_consecutive_checks:
        return True

    return False
```

**æ ¸å¿ƒè®¾è®¡åŸç†**ï¼š
- **èµ„æºä¸è¶³ï¼ˆFalseï¼‰**ï¼šç«‹å³å“åº”ï¼Œæ‰§è¡Œ `alt_key`ï¼Œé¿å…è¡¥ç»™å»¶è¿Ÿ
- **èµ„æºå……è¶³ï¼ˆTrueï¼‰**ï¼šéœ€è¦è¿ç»­2æ¬¡ç¡®è®¤ï¼Œæ‰§è¡Œ `key`ï¼Œé˜²æ­¢è¯¯åˆ¤æµªè´¹èµ„æº
- **æ»‘åŠ¨çª—å£**ï¼šä½¿ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶ï¼Œä¿æŒè¿ç»­æ€§æ£€æµ‹çš„å®æ—¶æ€§
- **ç‹¬ç«‹å†å²**ï¼šæ¯ä¸ªæŠ€èƒ½ç»´æŠ¤ç‹¬ç«‹çš„æ£€æµ‹å†å²è®°å½•

**é…ç½®å‚æ•°**ï¼š
- `_required_consecutive_checks = 2`ï¼šé»˜è®¤éœ€è¦è¿ç»­2æ¬¡Trueç¡®è®¤
- æ¯ä¸ªæŠ€èƒ½ç‹¬ç«‹è·Ÿè¸ªï¼š`_resource_condition_history = {skill_name: [å†å²ç»“æœ]}`

#### èµ„æºæ£€æµ‹ç±»å‹
| condition_color | æ£€æµ‹ç±»å‹ | è¯´æ˜ |
|-----------------|----------|------|
| 0 | èµ„æºå……è¶³æ€§ | é€šç”¨èµ„æºæ¡æ£€æµ‹ï¼ˆMPã€æ€’æ°”ã€èƒ½é‡ç­‰ï¼‰ |
| 1 | HPå……è¶³æ€§ | ä¸“ç”¨HPæ£€æµ‹ï¼Œé€‚é…ç”Ÿå‘½çƒç‰¹æ®Šå½¢çŠ¶ |
| å…¶ä»–RGBå€¼ | é¢œè‰²åŒ¹é… | ç²¾ç¡®çš„RGBé¢œè‰²ç›¸ä¼¼åº¦æ£€æµ‹ |

#### åŒæŒ‰é”®ç­–ç•¥
- **ä¸»æŒ‰é”®ï¼ˆkeyï¼‰**ï¼šèµ„æºå……è¶³ä¸”è¿ç»­ç¡®è®¤æ—¶ä½¿ç”¨çš„é«˜æ¶ˆè€—æŠ€èƒ½
- **å¤‡ç”¨æŒ‰é”®ï¼ˆalt_keyï¼‰**ï¼šèµ„æºä¸è¶³æ—¶ç«‹å³æ‰§è¡Œçš„ä½æ¶ˆè€—æ›¿ä»£æŠ€èƒ½  
- **æ™ºèƒ½åˆ‡æ¢**ï¼šæ ¹æ®å®æ—¶èµ„æºçŠ¶æ€å’ŒäºŒæ¬¡ç¡®è®¤ç»“æœè‡ªåŠ¨é€‰æ‹©

#### æ£€æµ‹é€»è¾‘æµç¨‹
```
1. è·å–ç¼“å­˜å¸§æ•°æ®
   â†“
2. æ ¹æ®condition_colorç±»å‹æ‰§è¡Œç›¸åº”æ£€æµ‹
   â†“
3. è°ƒç”¨_check_resource_continuity()è¿›è¡ŒäºŒæ¬¡ç¡®è®¤
   â†“
4. èµ„æºä¸è¶³ â†’ ç«‹å³è¿”å›False â†’ æ‰§è¡Œalt_key
   â†“
5. èµ„æºå……è¶³ â†’ æ£€æŸ¥è¿ç»­ç¡®è®¤ â†’ æ»¡è¶³æ¡ä»¶æ‰§è¡Œkey
```

---

## ğŸ”§ é«˜çº§é…ç½®æŠ€å·§

### 1. æŠ€èƒ½ä¼˜å…ˆçº§é…ç½®
```json
{
  "skills": [
    {
      "name": "ç´§æ€¥æ²»ç–—",
      "priority": "emergency",
      "execute_condition": 2,
      "resource_type": "hp",
      "resource_threshold": 30
    },
    {
      "name": "ä¸»è¦è¾“å‡º",
      "priority": "high",
      "execute_condition": 1,
      "buff_coords": [300, 100, 40, 40]
    },
    {
      "name": "è¾…åŠ©æŠ€èƒ½",
      "priority": "normal",
      "execute_condition": 0
    },
    {
      "name": "æ‹¾å–ç‰©å“",
      "priority": "low",
      "execute_condition": 0
    }
  ]
}
```

#### ä¼˜å…ˆçº§ç­‰çº§è¯´æ˜
- **emergency**ï¼šç´§æ€¥ä¼˜å…ˆçº§ï¼Œç”¨äºHP/MPè¯å‰‚ç­‰å…³é”®æ“ä½œ
- **high**ï¼šé«˜ä¼˜å…ˆçº§ï¼Œç”¨äºæ ¸å¿ƒè¾“å‡ºå’Œé‡è¦BUFFæŠ€èƒ½
- **normal**ï¼šæ™®é€šä¼˜å…ˆçº§ï¼Œç”¨äºå¸¸è§„æ”»å‡»æŠ€èƒ½
- **low**ï¼šä½ä¼˜å…ˆçº§ï¼Œç”¨äºè¾…åŠ©åŠŸèƒ½å’Œç•Œé¢æ“ä½œ

### 2. æ¡ä»¶ç»„åˆç­–ç•¥
```json
{
  "name": "å¤åˆæ¡ä»¶æŠ€èƒ½",
  "key": "q",
  "execute_condition": 2,
  "resource_coords": [50, 950, 200, 20],
  "resource_threshold": 80,
  "additional_conditions": {
    "buff_check": {
      "coords": [200, 100, 30, 30],
      "required": false
    },
    "enemy_presence": {
      "coords": [500, 400, 100, 100],
      "required": true
    }
  }
}
```

### 3. ç¯å¢ƒé€‚é…é…ç½®
```json
{
  "profiles": {
    "1920x1080": {
      "hp_region": [136, 910, 213, 1004],
      "mp_region": [136, 870, 213, 894],
      "skill_size": 20
    },
    "2560x1440": {
      "hp_region": [181, 1213, 284, 1339],
      "mp_region": [181, 1160, 284, 1192],
      "skill_size": 27
    }
  }
}
```

### 4. ä¼˜å…ˆçº§æŒ‰é”®é…ç½®
```json
{
  "priority_keys": {
    "enabled": true,
    "keys": ["space", "right_mouse"],
    "description": "é—ªé¿+å³é”®æŠ€èƒ½ä¼˜å…ˆçº§"
  }
}
```

#### é…ç½®è¯´æ˜
- **enabled**ï¼šæ˜¯å¦å¯ç”¨ä¼˜å…ˆçº§æŒ‰é”®ç³»ç»Ÿ
- **keys**ï¼šä¼˜å…ˆçº§æŒ‰é”®åˆ—è¡¨ï¼Œæ”¯æŒå¤šç§æŒ‰é”®åç§°å˜ä½“
- **description**ï¼šé…ç½®æè¿°ï¼ˆå¯é€‰ï¼‰

#### æ”¯æŒçš„æŒ‰é”®ç±»å‹
- **é”®ç›˜æŒ‰é”®**ï¼š`space`, `ctrl`, `shift`, `alt`, `tab`, `enter`, `esc`, `a-z`, `0-9`, `f1-f12`
- **é¼ æ ‡æŒ‰é”®**ï¼š`left_mouse`, `right_mouse`, `middle_mouse`
- **æŒ‰é”®æ ‡å‡†åŒ–**ï¼šè‡ªåŠ¨å¤„ç†å˜ä½“ï¼ˆå¦‚ `spacebar` â†’ `space`ï¼‰

### 5. æ™ºèƒ½è¯å‰‚åœ†å½¢æ£€æµ‹é…ç½®
```json
{
  "resource_management": {
    "hp_config": {
      "enabled": true,
      "key": "1",
      "threshold": 50,
      "center_x": 175,
      "center_y": 957,
      "radius": 39,
      "colors": [
        {
          "name": "HP Normal",
          "target_h": 157,
          "target_s": 75,
          "target_v": 29,
          "tolerance_h": 5,
          "tolerance_s": 20,
          "tolerance_v": 20
        }
      ]
    },
    "mp_config": {
      "enabled": true,
      "key": "2",
      "threshold": 50,
      "center_x": 175,
      "center_y": 957,
      "radius": 39,
      "colors": [
        {
          "name": "MP Normal",
          "target_h": 104,
          "target_s": 80,
          "target_v": 58,
          "tolerance_h": 4,
          "tolerance_s": 5,
          "tolerance_v": 5
        }
      ]
    }
  }
}
```

#### åœ†å½¢æ£€æµ‹ä¼˜åŠ¿
- **ç²¾ç¡®åº¦æ›´é«˜**ï¼šåªæ£€æµ‹çƒä½“åŒºåŸŸï¼Œæ’é™¤èƒŒæ™¯å¹²æ‰°
- **è‡ªåŠ¨è¯†åˆ«**ï¼šæ”¯æŒ"Detect Orbs"æŒ‰é’®è‡ªåŠ¨è¯†åˆ«çƒä½“ä½ç½®
- **æŠ—å¹²æ‰°å¼º**ï¼šåœ†å½¢è’™ç‰ˆç¡®ä¿åªè®¡ç®—çƒä½“å†…çš„åƒç´ 

#### çŸ©å½¢æ£€æµ‹é…ç½®ï¼ˆå‘åå…¼å®¹ï¼‰
```json
{
  "resource_management": {
    "hp_config": {
      "enabled": true,
      "key": "1",
      "threshold": 50,
      "region_x1": 136,
      "region_y1": 910,
      "region_x2": 213,
      "region_y2": 1004,
      "colors": [...]
    }
  }
}
```

### 6. è°ƒè¯•é…ç½®
```json
{
  "debug": {
    "enabled": true,
    "log_conditions": true,
    "log_resource_detection": true,
    "log_priority_keys": true,
    "save_detection_frames": false,
    "condition_log_interval": 1000
  }
}
```

---

## ğŸ”„ é…ç½®æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼é…ç½®
```python
# ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æŠ€èƒ½é…ç½®
basic_skills = [
    {"name": "æ”»å‡»", "key": "1", "trigger_mode": 0, "execute_condition": 0}
]

# ç¬¬äºŒé˜¶æ®µï¼šæ·»åŠ å†·å´æ£€æµ‹
advanced_skills = [
    {"name": "æ”»å‡»", "key": "1", "trigger_mode": 1, "execute_condition": 0,
     "cooldown_coords": [100, 50, 20, 20]}
]

# ç¬¬ä¸‰é˜¶æ®µï¼šæ·»åŠ å¤æ‚æ¡ä»¶
expert_skills = [
    {"name": "æ”»å‡»", "key": "1", "trigger_mode": 1, "execute_condition": 2,
     "cooldown_coords": [100, 50, 20, 20],
     "resource_coords": [50, 950, 200, 20],
     "resource_threshold": 70}
]
```

### 2. é…ç½®æ¨¡æ¿
```json
{
  "templates": {
    "basic_skill": {
      "trigger_mode": 1,
      "execute_condition": 0,
      "priority": "normal",
      "enabled": true
    },
    "high_priority_skill": {
      "trigger_mode": 1,
      "execute_condition": 0,
      "priority": "high",
      "enabled": true
    },
    "emergency_skill": {
      "trigger_mode": 1,
      "execute_condition": 0,
      "priority": "emergency",
      "enabled": true
    },
    "resource_skill": {
      "trigger_mode": 1,
      "execute_condition": 2,
      "resource_threshold": 70,
      "continuity_window": 3,
      "continuity_threshold": 2,
      "priority": "normal"
    },
    "buff_skill": {
      "trigger_mode": 1,
      "execute_condition": 1,
      "buff_tolerance": 20,
      "priority": "high"
    },
    "circular_hp_potion": {
      "enabled": true,
      "threshold": 50,
      "center_x": 175,
      "center_y": 957,
      "radius": 39,
      "colors": [
        {
          "name": "HP Normal",
          "target_h": 157,
          "target_s": 75,
          "target_v": 29,
          "tolerance_h": 5,
          "tolerance_s": 20,
          "tolerance_v": 20
        }
      ]
    },
    "rectangular_mp_potion": {
      "enabled": true,
      "threshold": 50,
      "region_x1": 1552,
      "region_y1": 910,
      "region_x2": 1560,
      "region_y2": 1004,
      "colors": [
        {
          "name": "MP Normal",
          "target_h": 104,
          "target_s": 80,
          "target_v": 58,
          "tolerance_h": 4,
          "tolerance_s": 5,
          "tolerance_v": 5
        }
      ]
    }
  }
}
```

### 3. é…ç½®éªŒè¯
```python
def validate_skill_config(skill_config):
    """é…ç½®éªŒè¯å‡½æ•°"""
    errors = []

    # å¿…éœ€å­—æ®µæ£€æŸ¥
    required_fields = ["name", "key", "trigger_mode"]
    for field in required_fields:
        if field not in skill_config:
            errors.append(f"ç¼ºå°‘å¿…éœ€å­—æ®µ: {field}")

    # ä¼˜å…ˆçº§éªŒè¯
    priority = skill_config.get("priority", "normal")
    valid_priorities = ["emergency", "high", "normal", "low"]
    if priority not in valid_priorities:
        errors.append(f"æ— æ•ˆçš„ä¼˜å…ˆçº§: {priority}ï¼Œåº”ä¸º: {valid_priorities}")

    # æ¡ä»¶ç‰¹å®šéªŒè¯
    execute_condition = skill_config.get("execute_condition", 0)
    if execute_condition == 1:  # BUFFæ¡ä»¶
        if not skill_config.get("buff_coords"):
            errors.append("BUFFæ¡ä»¶æ¨¡å¼éœ€è¦é…ç½®buff_coords")
    elif execute_condition == 2:  # èµ„æºæ¡ä»¶
        if not skill_config.get("resource_coords"):
            errors.append("èµ„æºæ¡ä»¶æ¨¡å¼éœ€è¦é…ç½®resource_coords")

    return errors

def validate_resource_config(resource_config):
    """æ™ºèƒ½è¯å‰‚é…ç½®éªŒè¯"""
    errors = []

    # æ£€æŸ¥æ˜¯å¦è‡³å°‘é…ç½®äº†çŸ©å½¢æˆ–åœ†å½¢æ£€æµ‹æ–¹å¼
    has_rect_config = all(k in resource_config for k in ["region_x1", "region_y1", "region_x2", "region_y2"])
    has_circle_config = all(k in resource_config for k in ["center_x", "center_y", "radius"])

    if not has_rect_config and not has_circle_config:
        errors.append("éœ€è¦é…ç½®çŸ©å½¢æ£€æµ‹åŒºåŸŸæˆ–åœ†å½¢æ£€æµ‹å‚æ•°")

    # é¢œè‰²é…ç½®éªŒè¯
    colors = resource_config.get("colors", [])
    if not colors:
        errors.append("è‡³å°‘éœ€è¦é…ç½®ä¸€ç§é¢œè‰²ç”¨äºæ£€æµ‹")

    for i, color in enumerate(colors):
        required_fields = ["target_h", "target_s", "target_v", "tolerance_h", "tolerance_s", "tolerance_v"]
        for field in required_fields:
            if field not in color:
                errors.append(f"é¢œè‰²{i+1}ç¼ºå°‘å­—æ®µ: {field}")

    return errors

def validate_priority_keys_config(config):
    """ä¼˜å…ˆçº§æŒ‰é”®é…ç½®éªŒè¯"""
    errors = []

    if not isinstance(config.get("enabled"), bool):
        errors.append("enabledå­—æ®µå¿…é¡»ä¸ºå¸ƒå°”å€¼")

    keys = config.get("keys", [])
    if not isinstance(keys, list):
        errors.append("keyså­—æ®µå¿…é¡»ä¸ºæ•°ç»„")

    # æ ‡å‡†åŒ–æŒ‰é”®åç§°æ£€æŸ¥
    valid_key_patterns = [
        r'^[a-zA-Z0-9]$',  # å•å­—æ¯æ•°å­—
        r'^f[0-9]{1,2}$',  # F1-F12
        r'^(ctrl|shift|alt|space|tab|enter|esc)$',  # ç‰¹æ®Šé”®
        r'^(left_mouse|right_mouse|middle_mouse)$'  # é¼ æ ‡é”®
    ]

    import re
    for key in keys:
        if not any(re.match(pattern, key) for pattern in valid_key_patterns):
            errors.append(f"æ— æ•ˆçš„æŒ‰é”®åç§°: {key}")

    return errors
```

é€šè¿‡è¿™å¥—å®Œæ•´çš„é…ç½®å’Œæ¡ä»¶ç³»ç»Ÿï¼Œpyahkèƒ½å¤Ÿé€‚åº”å„ç§å¤æ‚çš„æ¸¸æˆåœºæ™¯å’Œç”¨æˆ·éœ€æ±‚ï¼Œæä¾›ç²¾ç¡®çš„è‡ªåŠ¨åŒ–æ§åˆ¶èƒ½åŠ›ã€‚