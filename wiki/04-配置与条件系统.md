# 04 é…ç½®ä¸æ¡ä»¶ç³»ç»Ÿ

## æ¦‚è¿°

é…ç½®ç³»ç»Ÿæ˜¯pyahkçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œæä¾›çµæ´»çš„JSONé…ç½®ç®¡ç†å’Œå¼ºå¤§çš„æ¡ä»¶é€»è¾‘ç³»ç»Ÿã€‚æ”¯æŒçƒ­é‡è½½ã€é…ç½®éªŒè¯å’Œå¤šé…ç½®æ–‡ä»¶ç®¡ç†ï¼Œä¸ºå¤æ‚çš„æ¸¸æˆè‡ªåŠ¨åŒ–éœ€æ±‚æä¾›ç²¾ç¡®çš„æ§åˆ¶èƒ½åŠ›ã€‚

---

## ğŸ“‹ é…ç½®ç®¡ç†æ¶æ„

### ConfigManager æ ¸å¿ƒåŠŸèƒ½
```python
class ConfigManager:
    """ç»Ÿä¸€é…ç½®ç®¡ç†å™¨"""
    def __init__(self):
        self._configs = {}
        self._watchers = {}
        self._schema_validator = None
    
    def load_config(self, config_file: str) -> dict:
        """åŠ è½½å¹¶éªŒè¯é…ç½®æ–‡ä»¶"""
        
    def save_config(self, config_file: str, config_data: dict):
        """ä¿å­˜é…ç½®åˆ°æ–‡ä»¶"""
        
    def hot_reload(self, config_file: str):
        """çƒ­é‡è½½é…ç½®ï¼Œæ— éœ€é‡å¯ç¨‹åº"""
```

### é…ç½®æ–‡ä»¶ç»“æ„
```json
{
  "version": "1.0",
  "global": {
    "debug_mode": false,
    "capture_interval": 100,
    "log_level": "INFO"
  },
  "skills": [
    {
      "name": "ä¸»è¦æŠ€èƒ½",
      "key": "1",
      "trigger_mode": 1,
      "execute_condition": 2,
      "priority": "high",
      "enabled": true
    }
  ],
  "resource_management": {
    "hp_config": {
      "enabled": true,
      "key": "1",
      "threshold": 50,
      "detection_mode": "circle",
      "center_x": 175,
      "center_y": 957,
      "radius": 39,
      "colors": [
        {
          "name": "HP Normal",
          "target_h": 157,
          "target_s": 75,
          "target_v": 29,
          "tolerance_h": 5,
          "tolerance_s": 20,
          "tolerance_v": 20
        }
      ]
    },
    "mp_config": {
      "enabled": true,
      "key": "2",
      "threshold": 50,
      "detection_mode": "text_ocr",
      "text_x1": 1552,
      "text_y1": 910,
      "text_x2": 1560,
      "text_y2": 1004,
      "match_threshold": 0.70
    },
    "check_interval": 200
  },
  "priority_keys": {
    "enabled": true,
    "special_keys": ["space"],
    "managed_keys": {
      "right_mouse": { "target": "right_mouse", "delay": 50 },
      "e": { "target": "0", "delay": 30 }
    }
  },
  "stationary_mode_config": {
    "hotkey": "xbutton1",
    "mode_type": "shift_modifier",
    "force_move_hotkey": "x"
  },
  "pathfinding_config": {
    "hotkey": "f9",
    "enabled": false,
    "minimap_region": [1670, 50, 200, 200]
  },
  "affix_reroll": {
    "enabled": false,
    "target_affixes": ["æš´å‡»ç‡", "æš´å‡»ä¼¤å®³"],
    "max_attempts": 100
  }
}
```

### é…ç½®éªŒè¯ä¸ç±»å‹æ£€æŸ¥
```python
from pydantic import BaseModel, Field
from typing import List, Optional, Tuple

class SkillConfig(BaseModel):
    name: str
    key: str                          # ä¸»è¦æŒ‰é”® - æ”¯æŒåºåˆ—æ ¼å¼
    alt_key: Optional[str] = None     # è¾…åŠ©æŒ‰é”® - æ”¯æŒåºåˆ—æ ¼å¼
    trigger_mode: int = Field(ge=0, le=2)
    execute_condition: int = Field(ge=0, le=2)
    priority: bool = False
    enabled: bool = True
    interval: Optional[int] = Field(None, ge=50)
    cooldown_coords: Optional[List[int]] = None

class PriorityKeysConfig(BaseModel):
    enabled: bool = True
    keys: List[str] = []
    delay_ms: int = Field(50, ge=0, le=500)  # ä¼˜å…ˆçº§å»¶è¿Ÿä¿æŠ¤ï¼ˆ0-500msï¼‰

class GlobalConfig(BaseModel):
    debug_mode: bool = False
    capture_interval: int = Field(100, ge=50, le=1000)
    log_level: str = Field("INFO", regex="^(DEBUG|INFO|WARNING|ERROR)$")
```

### ğŸš€ æŒ‰é”®åºåˆ—é…ç½®

#### åºåˆ—æ ¼å¼æ”¯æŒ
```json
{
  "name": "ç«çƒè¿å‡»",
  "key": "delay50,q",              // å»¶è¿Ÿ50msåæŒ‰qé”®
  "alt_key": "delay100,shift+q",   // å»¶è¿Ÿ100msåæŒ‰ç»„åˆé”®
  "trigger_mode": 0,
  "interval": 2000
}
```

#### å¤æ‚åºåˆ—ç¤ºä¾‹
```json
{
  "name": "ä¸‰è¿å‡»æŠ€èƒ½",
  "key": "1,delay200,2,delay150,3",    // è¿ç»­æŠ€èƒ½é‡Šæ”¾
  "alt_key": "delay100,ctrl+1",        // å¼ºåŒ–ç‰ˆæœ¬
  "trigger_mode": 1,                   // å†·å´è§¦å‘
  "cooldown_coords": [100, 50, 20, 20]
}
```

#### åºåˆ—éªŒè¯è§„åˆ™
```python
def validate_key_sequence(key_sequence: str) -> bool:
    """éªŒè¯æŒ‰é”®åºåˆ—æ ¼å¼"""
    if not key_sequence:
        return False
    
    # æ”¯æŒå•ä¸ªæŒ‰é”®æˆ–é€—å·åˆ†éš”çš„åºåˆ—
    if ',' not in key_sequence:
        return validate_single_key(key_sequence)
    
    # éªŒè¯åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ 
    for key_part in key_sequence.split(','):
        key_part = key_part.strip()
        if key_part.startswith('delay'):
            # éªŒè¯å»¶è¿Ÿæ ¼å¼ï¼šdelay50, delay100, etc.
            try:
                delay_ms = int(key_part[5:])
                if delay_ms < 0 or delay_ms > 10000:
                    return False
            except ValueError:
                return False
        else:
            if not validate_single_key(key_part):
                return False
    return True
```

#### å»¶è¿ŸæŒ‡ä»¤æœ€ä½³å®è·µ

**æ¨èèŒƒå›´**ï¼š
- **æœ€ä½³èŒƒå›´**ï¼š50-500msï¼ˆé€‚åˆå¤§å¤šæ•°æ¸¸æˆåœºæ™¯ï¼‰
- **æœ€å°å€¼**ï¼šç†è®ºä¸Šæ”¯æŒ0msï¼Œä½†æ— å®é™…æ„ä¹‰
- **æœ€å¤§å€¼**ï¼šè™½ç„¶ä»£ç æ”¯æŒ10000msï¼Œä½†ä¸æ¨èè¶…è¿‡1000ms
- **æ€§èƒ½è€ƒè™‘**ï¼šè¿‡é•¿çš„å»¶è¿Ÿä¼šå½±å“å“åº”é€Ÿåº¦

**å¸¸ç”¨å»¶è¿Ÿå€¼**ï¼š
```json
{
  "delay50": "æŠ€èƒ½å‰æ‘‡ä¿æŠ¤ï¼Œç¡®ä¿æ¸¸æˆå“åº”",
  "delay100": "çŸ­æš‚ç­‰å¾…ï¼Œé€‚åˆå¿«é€Ÿè¿æ‹›",
  "delay200": "ä¸­ç­‰å»¶è¿Ÿï¼Œé€‚åˆæ™®é€šæŠ€èƒ½é—´éš”",
  "delay500": "é•¿åŠ¨ç”»ç­‰å¾…ï¼Œé€‚åˆå¤§æ‹›é‡Šæ”¾"
}
```

**åºåˆ—æ ¼å¼è§„èŒƒ**ï¼š
1. **åˆ†éš”ç¬¦**ï¼šå¿…é¡»ä½¿ç”¨è‹±æ–‡é€—å· `,`
2. **ç©ºæ ¼å¤„ç†**ï¼šé€—å·å‰åçš„ç©ºæ ¼ä¼šè¢«è‡ªåŠ¨trimï¼ˆä½†ä¸æ¨èæ·»åŠ ï¼‰
3. **å»¶è¿Ÿæ ¼å¼**ï¼š`delay` + æ•°å­—ï¼Œæ— ç­‰å·ï¼Œæ— ç©ºæ ¼
   - âœ… æ­£ç¡®ï¼š`delay50`
   - âŒ é”™è¯¯ï¼š`delay=50`, `delay 50`, `delay_50`
4. **ç»„åˆé”®**ï¼šä½¿ç”¨ `+` è¿æ¥ï¼Œå¦‚ `shift+q`, `ctrl+alt+tab`
5. **åºåˆ—é•¿åº¦**ï¼šç†è®ºä¸Šæ— é™åˆ¶ï¼Œä½†å»ºè®®ä¸è¶…è¿‡10ä¸ªå…ƒç´ 

**é”™è¯¯å¤„ç†æœºåˆ¶**ï¼š
- **æ ¼å¼é”™è¯¯**ï¼šæ— æ•ˆçš„delayæ ¼å¼ä¼šè¢«è®°å½•åˆ°æ—¥å¿—ï¼Œè¯¥æŒ‡ä»¤è¢«è·³è¿‡
- **é˜Ÿåˆ—æ»¡**ï¼šåºåˆ—éƒ¨åˆ†å…ƒç´ å¯èƒ½è¢«ä¸¢å¼ƒï¼Œæ—¥å¿—ä¼šè®°å½•è­¦å‘Š
- **ä¸­æ–­å¤„ç†**ï¼šç³»ç»Ÿåœæ­¢æ—¶ï¼Œæœªå®Œæˆçš„åºåˆ—ä¼šè¢«è‡ªåŠ¨æ¸…ç†
- **å»é‡ä¿æŠ¤**ï¼šé‡å¤çš„åºåˆ—è¯·æ±‚ä¼šè¢«æ™ºèƒ½è¿‡æ»¤

---

## ğŸ® åŸåœ°æ¨¡å¼é…ç½®

### åŠŸèƒ½è¯´æ˜
åŸåœ°æ¨¡å¼æ˜¯ARPGæ¸¸æˆä¸­çš„æ ¸å¿ƒæˆ˜æ–—è¾…åŠ©åŠŸèƒ½ï¼Œå…è®¸è§’è‰²åœ¨ä¸ç§»åŠ¨çš„æƒ…å†µä¸‹é‡Šæ”¾æŠ€èƒ½ã€‚pyahkæä¾›ä¸¤ç§å®ç°æ–¹å¼ï¼Œé€‚é…ä¸åŒæ¸¸æˆå’Œç©å®¶ä¹ æƒ¯ã€‚

### é…ç½®å‚æ•°

**hotkey**ï¼šåŸåœ°æ¨¡å¼åˆ‡æ¢é”®
- é€šå¸¸ä½¿ç”¨é¼ æ ‡ä¾§é”®ï¼ˆxbutton1/xbutton2ï¼‰æˆ–é”®ç›˜æŒ‰é”®ï¼ˆå¦‚Xé”®ï¼‰
- æŒ‰ä¸€æ¬¡è¿›å…¥åŸåœ°æ¨¡å¼ï¼Œå†æŒ‰ä¸€æ¬¡é€€å‡º
- OSDä¼šå®æ—¶æ˜¾ç¤ºå½“å‰çŠ¶æ€
- **å¦‚æœç•™ç©ºæˆ–ä¸è®¾ç½®ï¼ŒåŸåœ°æ¨¡å¼åŠŸèƒ½å°†ä¸ä¼šå¯ç”¨**

**mode_type**ï¼šæ¨¡å¼ç±»å‹ï¼Œå†³å®šåŸåœ°æ¨¡å¼çš„å®ç°æ–¹å¼
- `shift_modifier`ï¼ˆæ¨èï¼‰ï¼šè‡ªåŠ¨ä¸ºæ‰€æœ‰æŠ€èƒ½é”®æ·»åŠ Shiftä¿®é¥°ç¬¦ï¼Œåˆ©ç”¨æ¸¸æˆåŸç”Ÿçš„"Shift+æŠ€èƒ½=åŸåœ°é‡Šæ”¾"æœºåˆ¶ã€‚ä¼˜ç‚¹æ˜¯å®Œå…¨å…¼å®¹æ¸¸æˆæœºåˆ¶ï¼Œä¸å½±å“é¼ æ ‡ç§»åŠ¨ï¼›ç¼ºç‚¹æ˜¯éœ€è¦æ¸¸æˆæ”¯æŒShiftä¿®é¥°ç¬¦ã€‚é€‚ç”¨äºD4ã€POE2ç­‰æ ‡å‡†ARPGæ¸¸æˆã€‚
- `block_mouse`ï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰ï¼šç›´æ¥å±è”½é¼ æ ‡å·¦å³é”®ï¼Œé˜²æ­¢è§’è‰²ç§»åŠ¨ã€‚ä¼˜ç‚¹æ˜¯ä¸ä¾èµ–æ¸¸æˆæœºåˆ¶ï¼›ç¼ºç‚¹æ˜¯å®Œå…¨é˜»æ­¢é¼ æ ‡æ”»å‡»å’Œäº¤äº’ã€‚é€‚ç”¨äºä¸æ”¯æŒShiftä¿®é¥°ç¬¦çš„æ¸¸æˆã€‚

**force_move_hotkey**ï¼šå¼ºåˆ¶ç§»åŠ¨/äº¤äº’é”®
- åœ¨åŸåœ°æ¨¡å¼æ¿€æ´»æ—¶ï¼Œæ­¤æŒ‰é”®ä¸å—å½±å“ï¼Œä¿æŒæ­£å¸¸åŠŸèƒ½
- å…¸å‹ç”¨é€”ï¼šD4/POE2çš„å¼ºåˆ¶ç§»åŠ¨é”®ï¼ˆXé”®ï¼‰ã€æ¡è£…å¤‡ã€å¼€é—¨äº¤äº’ç­‰
- å…è®¸ç©å®¶åœ¨ä¸é€€å‡ºåŸåœ°æ¨¡å¼çš„æƒ…å†µä¸‹ä¸´æ—¶ç§»åŠ¨æˆ–äº¤äº’
- **å¦‚æœç•™ç©ºæˆ–ä¸è®¾ç½®ï¼Œäº¤äº’é”®åŠŸèƒ½å°†ä¸ä¼šå¯ç”¨**

### é…ç½®ç¤ºä¾‹

**D4å¾·é²ä¼Šé…ç½®**ï¼šä½¿ç”¨ä¾§é”®åˆ‡æ¢åŸåœ°æ¨¡å¼ï¼ŒXé”®ä¿æŒå¼ºåˆ¶ç§»åŠ¨åŠŸèƒ½
```json
{
  "stationary_mode_config": {
    "hotkey": "xbutton1",
    "mode_type": "shift_modifier",
    "force_move_hotkey": "x"
  }
}
```

**POE2é…ç½®**ï¼šXé”®åˆ‡æ¢åŸåœ°æ¨¡å¼ï¼ŒAé”®ç”¨äºå¼ºåˆ¶ç§»åŠ¨
```json
{
  "stationary_mode_config": {
    "hotkey": "x",
    "mode_type": "shift_modifier",
    "force_move_hotkey": "a"
  }
}
```

### é…ç½®åˆ‡æ¢æ³¨æ„äº‹é¡¹

å½“åˆ‡æ¢ä¸åŒé…ç½®æ–‡ä»¶æ—¶ï¼Œå¦‚æœåŒä¸€ä¸ªæŒ‰é”®åœ¨ä¸åŒé…ç½®ä¸­æ‰®æ¼”ä¸åŒè§’è‰²ï¼ˆä¾‹å¦‚Xé”®åœ¨é…ç½®Aä¸­æ˜¯force_move_hotkeyï¼Œåœ¨é…ç½®Bä¸­æ˜¯stationary hotkeyï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†çƒ­é”®é‡æ–°æ³¨å†Œã€‚ä»v2025.01.11ç‰ˆæœ¬å¼€å§‹ï¼ŒåŠ è½½æ–°é…ç½®æ—¶ä¼šå…ˆå–æ¶ˆæ‰€æœ‰å¯é…ç½®çƒ­é”®ï¼Œå†é‡æ–°æ³¨å†Œï¼Œé¿å…è§’è‰²è½¬æ¢å†²çªã€‚

å¦‚æœé‡åˆ°åˆ‡æ¢é…ç½®åçƒ­é”®å¤±æ•ˆçš„é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ï¼š
- `[çƒ­é”®ç®¡ç†] å–æ¶ˆæ³¨å†Œæ‰€æœ‰å¯é…ç½®çƒ­é”®`
- `[çƒ­é”®ç®¡ç†] æˆåŠŸæ³¨å†Œçƒ­é”® 'stationary': x`
- `[è¾“å…¥å¤„ç†å™¨] åŸåœ°æ¨¡å¼ç±»å‹å·²æ›´æ–°: shift_modifier`

---

## ğŸ—ºï¸ è‡ªåŠ¨å¯»è·¯é…ç½®

### åŠŸèƒ½è¯´æ˜
è‡ªåŠ¨å¯»è·¯ç³»ç»ŸåŸºäºå°åœ°å›¾è¯†åˆ«å’ŒA*ç®—æ³•ï¼Œå®ç°æ™ºèƒ½è·¯å¾„è§„åˆ’å’Œéšœç¢ç‰©ç»•è¡Œã€‚é€‚ç”¨äºåœ°å›¾æ¢ç´¢ã€è‡ªåŠ¨è·‘å›¾ç­‰åœºæ™¯ã€‚

### é…ç½®å‚æ•°

**hotkey**ï¼šå¯»è·¯åŠŸèƒ½å¼€å…³é”®
- é»˜è®¤ä¸ºF9é”®
- æŒ‰ä¸€æ¬¡å¯åŠ¨å¯»è·¯ï¼Œå†æŒ‰ä¸€æ¬¡åœæ­¢
- ä¸åŸåœ°æ¨¡å¼ã€å¼ºåˆ¶ç§»åŠ¨é”®ä¸€æ ·æ”¯æŒåŠ¨æ€é…ç½®æ›´æ–°
- **å¦‚æœç•™ç©ºæˆ–ä¸è®¾ç½®ï¼Œå¯»è·¯åŠŸèƒ½å°†ä¸ä¼šå¯ç”¨**

**enabled**ï¼šæ˜¯å¦å¯ç”¨å¯»è·¯åŠŸèƒ½
- é»˜è®¤ä¸ºfalseï¼ˆå…³é—­çŠ¶æ€ï¼‰
- å¯»è·¯åŠŸèƒ½è¾ƒæ¶ˆè€—CPUèµ„æºï¼Œå»ºè®®æŒ‰éœ€å¯ç”¨
- å³ä½¿enabledä¸ºfalseï¼Œhotkeyä»ä¼šæ³¨å†Œï¼Œæ–¹ä¾¿ä¸´æ—¶å¯ç”¨

**minimap_region**ï¼šå°åœ°å›¾æˆªå›¾åŒºåŸŸ
- æ ¼å¼ï¼š[x, y, width, height]
- éœ€è¦æ ¹æ®æ¸¸æˆåˆ†è¾¨ç‡å’ŒUIç¼©æ”¾è¿›è¡Œè°ƒæ•´
- 1920x1080åˆ†è¾¨ç‡å‚è€ƒå€¼ï¼š[1670, 50, 200, 200]
- 2560x1440åˆ†è¾¨ç‡å‚è€ƒå€¼ï¼š[2230, 67, 267, 267]

### é…ç½®ç¤ºä¾‹

**åŸºç¡€é…ç½®**ï¼šç¦ç”¨å¯»è·¯ï¼Œä½†ä¿ç•™çƒ­é”®
```json
{
  "pathfinding_config": {
    "hotkey": "f9",
    "enabled": false
  }
}
```

**1080Påˆ†è¾¨ç‡é…ç½®**ï¼šå¯ç”¨å¯»è·¯
```json
{
  "pathfinding_config": {
    "hotkey": "f9",
    "enabled": true,
    "minimap_region": [1670, 50, 200, 200]
  }
}
```

---

## ğŸ® Torchlight Infinite ä¸“ç”¨é…ç½® (2025.10.18 æ–°å¢)

### æ¦‚è¿°

åŸºäºæœ€æ–°çš„æ¸¸æˆå…¼å®¹æ€§ä¼˜åŒ–ï¼Œpyahk ç°åœ¨æä¾›äº†ä¸“ä¸º Torchlight Infinite å®šåˆ¶çš„é…ç½®æ–‡ä»¶ `tors10.json`ã€‚è¯¥é…ç½®é’ˆå¯¹ TI çš„æ¸¸æˆæœºåˆ¶ã€UI å¸ƒå±€å’ŒæŠ€èƒ½ç³»ç»Ÿè¿›è¡Œäº†å…¨é¢ä¼˜åŒ–ã€‚

### æ ¸å¿ƒé…ç½®æ›´æ–°

#### çª—å£æ¿€æ´»é…ç½®

```json
{
  "global": {
    "window_activation": {
      "enabled": true,
      "ahk_class": "UnrealWindow",             // TI ä½¿ç”¨ Unreal å¼•æ“
      "ahk_exe": "torchlight_infinite.exe"     // TI è¿›ç¨‹å
    }
  }
}
```

#### HP æ¢å¤ç³»ç»Ÿä¼˜åŒ–

**å…³é”®å˜åŒ–**ï¼š
- **æŒ‰é”®ä» '1' æ”¹ä¸º 'c'**ï¼šæ›´ç¬¦åˆ TI çš„é»˜è®¤è®¾ç½®ä¹ æƒ¯
- **é˜ˆå€¼ä» 50% æå‡åˆ° 60%**ï¼šæé«˜ç”Ÿå­˜å®‰å…¨è¾¹é™…
- **æ–°çš„æ£€æµ‹åŒºåŸŸ**ï¼šé€‚é… TI çš„ UI å¸ƒå±€

```json
{
  "global": {
    "resource_management": {
      "hp_config": {
        "enabled": true,
        "key": "c",                    // â˜… ä» '1' æ”¹ä¸º 'c' é”®
        "threshold": 60,              // â˜… ä» 50% æå‡åˆ° 60%
        "cooldown": 1000,
        "detection_mode": "rectangle",
        "region_x1": 747,             // â˜… æ–°çš„HPæ£€æµ‹åŒºåŸŸ
        "region_y1": 978,
        "region_x2": 753,
        "region_y2": 1049,
        "colors": [
          {
            "name": "Color1",
            "target_h": 157,
            "target_s": 75,
            "target_v": 29,
            "tolerance_h": 10,
            "tolerance_s": 30,
            "tolerance_v": 50
          }
        ]
      }
    }
  }
}
```

#### æŠ€èƒ½æŒ‰é”®æ˜ å°„ä¼˜åŒ–

**ä¸»è¦æ”¹åŠ¨**ï¼š
- **å†·å´åæ ‡ç»Ÿä¸€ä¸º Y=1000**ï¼šé€‚é… TI çš„æŠ€èƒ½æ ä½ç½®
- **æŠ€èƒ½ç»„åˆé‡æ–°è®¾è®¡**ï¼šæ›´ç¬¦åˆ TI çš„æˆ˜æ–—èŠ‚å¥

```json
{
  "skills": {
    "Skill1": {
      "Enabled": false,              // åœ¨ TI ä¸­ä¸å¯ç”¨é¼ æ ‡ä¸»æ”»å‡»
      "Key": "LButton",
      "Priority": true,
      "CooldownCoordX": 815,
      "CooldownCoordY": 1000         // â˜… ç»Ÿä¸€ Y åæ ‡
    },
    "Skill3": {
      "Enabled": true,               // â˜… å¯ç”¨ Q é”®æŠ€èƒ½
      "Key": "q",
      "Timer": 650,
      "TriggerMode": 1,
      "CooldownCoordX": 925,
      "CooldownCoordY": 1000
    },
    "Skill4": {
      "Enabled": true,               // â˜… å¯ç”¨ E é”®æŠ€èƒ½
      "Key": "e",
      "Timer": 1000,
      "TriggerMode": 1,
      "CooldownCoordX": 980,
      "CooldownCoordY": 1000
    },
    "Skill6": {
      "Enabled": true,               // â˜… æ–°å¢ V é”®è¾…åŠ©æŠ€èƒ½
      "Key": "v",
      "Priority": false,
      "Timer": 195,
      "TriggerMode": 0,              // å®šæ—¶è§¦å‘æ¨¡å¼
      "ExecuteCondition": 0
    }
  }
}
```

#### ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–

**å†·å´æ£€æµ‹é—´éš”è°ƒæ•´**ï¼š
```json
{
  "global": {
    "cooldown_checker_interval": 125,  // ä» 120 è°ƒæ•´ä¸º 125ms
    "capture_interval": 55,            // ç»´æŒ 55ms æ•è·é—´éš”
    "queue_processor_interval": 35     // ç»´æŒ 35ms é˜Ÿåˆ—å¤„ç†é—´éš”
  }
}
```

### é…ç½®æ–‡ä»¶åˆ‡æ¢

#### é€šè¿‡ GUI åˆ‡æ¢

1. åœ¨ä¸»ç•Œé¢çš„â€œé…ç½®æ–‡ä»¶â€ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹© `tors10.json`
2. ç‚¹å‡»â€œåŠ è½½é…ç½®â€æŒ‰é’®
3. ç³»ç»Ÿä¼šè‡ªåŠ¨åº”ç”¨ Torchlight Infinite ä¸“ç”¨è®¾ç½®

#### é€šè¿‡å‘½ä»¤è¡Œåˆ‡æ¢

```bash
# å¯åŠ¨æ—¶æŒ‡å®š TI é…ç½®
python main.py --config tors10.json

# æˆ–è€…å¤åˆ¶ä¸ºé»˜è®¤é…ç½®
copy tors10.json default.json
```

### æ€§èƒ½ç‰¹æ€§ (2025.10.18)

#### SendMode Input ä¼˜åŒ–

AHK ç«¯ç°åœ¨ä½¿ç”¨ SendInput æ¨¡å¼ï¼Œæé«˜åœ¨ TI ä¸­çš„æŒ‰é”®è¯†åˆ«ç‡ï¼š

```ahk
SendMode "Input"  ; ä½¿ç”¨SendInputæ¨¡å¼ï¼Œæé«˜åœ¨æ¸¸æˆä¸­çš„è¯†åˆ«ç‡

SendPress(key) {
    ; å‘é€æŒ‰é”® (æŒ‰ä¸‹å¹¶é‡Šæ”¾ï¼Œæœ€å°å»¶æ—¶)
    Send "{" key " down}"
    Sleep 5                    ; â˜… 5ms æœ€å°å»¶æ—¶ç¡®ä¿ç¨³å®šæ€§
    Send "{" key " up}"
}
```

#### OSD çª—å£å¢å¼º

ä¸ºé˜²æ­¢ OSD çª—å£å¹²æ‰°æ¸¸æˆæ“ä½œï¼Œå¢åŠ äº†å¤šç§ç„¦ç‚¹é˜²æŠ¤å±æ€§ï¼š

```python
class OSDStatusWindow(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowFlags(
            Qt.WindowType.FramelessWindowHint
            | Qt.WindowType.WindowStaysOnTopHint
            | Qt.WindowType.Tool
            | Qt.WindowType.WindowDoesNotAcceptFocus  # â˜… ä¸æ¥å—ç„¦ç‚¹
        )
        
        # â˜… é€æ˜èƒŒæ™¯ä¸è¾“å…¥ç©¿é€ï¼Œé¿å…è·å–ç„¦ç‚¹ä¸æ‹¦æˆªé¼ æ ‡é”®ç›˜
        self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground)
        self.setAttribute(Qt.WidgetAttribute.WA_ShowWithoutActivating, True)
        self.setAttribute(Qt.WidgetAttribute.WA_TransparentForMouseEvents, True)
        
        try:
            # Qt 5.12+ å¯ç”¨ï¼ŒPySide6 æ”¯æŒï¼›è‹¥ä¸å¯ç”¨åˆ™å¿½ç•¥å¼‚å¸¸
            self.setWindowFlag(Qt.WindowType.WindowTransparentForInput, True)
        except Exception:
            pass
            
        self.setFocusPolicy(Qt.FocusPolicy.NoFocus)  # â˜… ç¦æ­¢ç„¦ç‚¹
```

### å…¼å®¹æ€§æ³¨æ„äº‹é¡¹

1. **æ¸¸æˆç‰ˆæœ¬**ï¼šè¯¥é…ç½®é€‚ç”¨äº Torchlight Infinite çš„å½“å‰ç‰ˆæœ¬ï¼Œæœªæ¥ç‰ˆæœ¬æ›´æ–°å¯èƒ½éœ€è¦è°ƒæ•´åæ ‡
2. **åˆ†è¾¨ç‡é€‚é…**ï¼šé»˜è®¤é€‚é… 1920x1080 åˆ†è¾¨ç‡ï¼Œå…¶ä»–åˆ†è¾¨ç‡å¯èƒ½éœ€è¦è°ƒæ•´åæ ‡
3. **UI ç¼©æ”¾**ï¼šå¦‚æœä¿®æ”¹äº†æ¸¸æˆå†…çš„ UI ç¼©æ”¾è®¾ç½®ï¼Œéœ€è¦é‡æ–°æ ¡å‡†æ£€æµ‹åŒºåŸŸ
4. **é”®ä½å†²çª**ï¼šç¡®ä¿æ¸¸æˆå†…çš„æŒ‰é”®è®¾ç½®ä¸é…ç½®æ–‡ä»¶ä¸€è‡´

### è°ƒè¯•ä¸ä¼˜åŒ–

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **å¯ç”¨è°ƒè¯•æ¨¡å¼**ï¼šåœ¨é…ç½®ä¸­è®¾ç½® `"debug_mode": true`
2. **æ£€æŸ¥æ—¥å¿—è¾“å‡º**ï¼šæŸ¥çœ‹æ§åˆ¶å°çš„ AHK å‘½ä»¤å’Œå“åº”æ—¥å¿—
3. **ä½¿ç”¨ OSD æ˜¾ç¤º**ï¼šå®æ—¶æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
4. **é€æ­¥æµ‹è¯•**ï¼šå…ˆæµ‹è¯•å•ä¸ªåŠŸèƒ½ï¼Œå†å¯ç”¨å…¨éƒ¨åŠŸèƒ½

**2Kåˆ†è¾¨ç‡é…ç½®**ï¼šè°ƒæ•´å°åœ°å›¾åŒºåŸŸ
```json
{
  "pathfinding_config": {
    "hotkey": "f9",
    "enabled": true,
    "minimap_region": [2230, 67, 267, 267]
  }
}
```

### ä½¿ç”¨å»ºè®®

1. **å°åœ°å›¾åŒºåŸŸè°ƒæ•´**ï¼šé¦–æ¬¡é…ç½®æ—¶ï¼Œå»ºè®®ä½¿ç”¨æˆªå›¾å·¥å…·æµ‹é‡æ¸¸æˆä¸­å°åœ°å›¾çš„å®é™…ä½ç½®å’Œå°ºå¯¸ï¼Œç¡®ä¿é…ç½®å‡†ç¡®ã€‚
2. **çƒ­é”®å†²çªé¿å…**ï¼šå¯»è·¯çƒ­é”®ä¸åº”ä¸æŠ€èƒ½é”®ã€åŸåœ°æ¨¡å¼é”®ã€å¼ºåˆ¶ç§»åŠ¨é”®å†²çªã€‚
3. **æ€§èƒ½è€ƒè™‘**ï¼šå¯»è·¯æ¶‰åŠå›¾åƒè¯†åˆ«å’Œè·¯å¾„è®¡ç®—ï¼Œå¦‚æœç”µè„‘é…ç½®è¾ƒä½ï¼Œå»ºè®®ä»…åœ¨éœ€è¦æ—¶å¯ç”¨ã€‚
4. **é…ç½®åˆ‡æ¢**ï¼šä¸åŒé…ç½®æ–‡ä»¶å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¯»è·¯çƒ­é”®ï¼Œç³»ç»Ÿä¼šåœ¨åˆ‡æ¢é…ç½®æ—¶è‡ªåŠ¨é‡æ–°æ³¨å†Œã€‚

---

### é…ç½®çƒ­é‡è½½æœºåˆ¶
```python
class ConfigWatcher:
    """é…ç½®æ–‡ä»¶å˜åŒ–ç›‘æ§"""
    def __init__(self, config_manager):
        self.config_manager = config_manager
        self.file_watchers = {}
    
    def watch_config_file(self, config_file: str):
        """ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨é‡è½½"""
        from watchdog.observers import Observer
        from watchdog.events import FileSystemEventHandler
        
        class ConfigFileHandler(FileSystemEventHandler):
            def on_modified(self, event):
                if event.src_path.endswith('.json'):
                    self.config_manager.hot_reload(event.src_path)
```

---

## ğŸ¯ æ¡ä»¶ç³»ç»Ÿè¯¦è§£

### è®¾è®¡ç›®æ ‡
- **ç®€å•å¯æšä¸¾**ï¼šä½¿ç”¨æ•´å‹æšä¸¾å€¼ 0/1/2 æ§åˆ¶åˆ†æ”¯
- **æ‰©å±•å‹å¥½**ï¼šæ–°å¢æ¡ä»¶æ—¶åªéœ€å¢åŠ æšä¸¾ + `_evaluate_condition` åˆ†æ”¯
- **ç¨³å®šé˜²æŠ–**ï¼šèµ„æºæ¡ä»¶åŠ å…¥è¿ç»­çª—å£ï¼Œé¿å…è¾¹ç•ŒæŠ–åŠ¨

### æ¡ä»¶æšä¸¾æ¦‚è§ˆ

| å€¼ | åç§° | è¯­ä¹‰ | é€‚ç”¨åœºæ™¯ |
|----|------|------|----------|
| 0 | æ— æ¡ä»¶ | ç›´æ¥å…è®¸æ‰§è¡Œ | æ™®é€šå¾ªç¯æŠ€èƒ½ |
| 1 | BUFF é™åˆ¶ | ä»…å½“æŒ‡å®š Buff ä¸å­˜åœ¨/å¤±æ•ˆæ—¶æ‰§è¡Œ | ç»´æŒç±»æŠ€èƒ½ã€éœ€åˆ·æ–°çŠ¶æ€ |
| 2 | èµ„æºæ¡ä»¶ | èµ„æºè¾¾åˆ°é˜ˆå€¼ä¸”åœ¨è¿ç»­çª—å£å†…ç¨³å®š | èµ„æºé©±åŠ¨çˆ†å‘/æ¶ˆè€—ç±» |

### æ‰§è¡Œè°ƒç”¨æ ˆ
```python
def _try_execute_skill(skill):
    """æŠ€èƒ½æ‰§è¡Œå…¥å£"""
    if not skill.enabled:
        return False
    
    if not self._check_execution_conditions(skill):
        return False
    
    return self._execute_skill_action(skill)

def _check_execution_conditions(skill):
    """æ¡ä»¶æ£€æŸ¥åˆ†å‘å™¨"""
    condition = skill.execute_condition
    
    if condition == 0:
        return True  # æ— æ¡ä»¶
    elif condition == 1:
        return self._evaluate_condition_buff(skill)
    elif condition == 2:
        return self._evaluate_condition_resource(skill)
    else:
        LOG_ERROR(f"æœªçŸ¥çš„æ‰§è¡Œæ¡ä»¶: {condition}")
        return False
```

### æ— æ¡ä»¶æ¨¡å¼ (ExecuteCondition = 0)
```json
{
  "name": "åŸºç¡€æ”»å‡»",
  "key": "1",
  "trigger_mode": 1,
  "execute_condition": 0,
  "cooldown_coords": [100, 50, 20, 20]
}
```
- **è¡Œä¸º**ï¼šå†·å´å°±ç»ªæ—¶ç›´æ¥æ‰§è¡Œä¸»æŒ‰é”®
- **é€‚ç”¨**ï¼šæ— ç‰¹æ®Šé™åˆ¶çš„å¸¸è§„æŠ€èƒ½
- **ä¼˜åŠ¿**ï¼šç®€å•ç›´æ¥ï¼Œæ€§èƒ½æœ€é«˜

### Buffé™åˆ¶æ¨¡å¼ (ExecuteCondition = 1)
```json
{
  "name": "æŠ¤ç›¾æŠ€èƒ½",
  "key": "e",
  "trigger_mode": 1,
  "execute_condition": 1,
  "buff_coords": [200, 100, 30, 30],
  "buff_color": [100, 150, 200],
  "buff_tolerance": 20
}
```

#### æ£€æµ‹é€»è¾‘
```python
def _evaluate_condition_buff(self, skill):
    """Buffå­˜åœ¨æ€§æ£€æµ‹"""
    if not skill.buff_coords:
        return True
    
    frame = self.border_manager.get_current_frame()
    if frame is None:
        return False
    
    x, y, w, h = skill.buff_coords
    roi = frame[y:y+h, x:x+w]
    
    # RGBé¢œè‰²åŒ¹é…æ£€æµ‹Buffå›¾æ ‡
    target_color = skill.buff_color
    tolerance = skill.buff_tolerance or 20
    
    similarity = self._calculate_color_similarity(roi, target_color)
    buff_exists = similarity > 0.8  # 80%ç›¸ä¼¼åº¦é˜ˆå€¼
    
    # Buffå­˜åœ¨æ—¶ä¸æ‰§è¡Œï¼Œä¸å­˜åœ¨æ—¶æ‰§è¡Œ
    return not buff_exists
```

#### åº”ç”¨åœºæ™¯
- **æŠ¤ç›¾æŠ€èƒ½**ï¼šæŠ¤ç›¾æ¶ˆå¤±æ—¶è‡ªåŠ¨é‡æ–°æ–½æ”¾
- **å¢ç›ŠBUFF**ï¼šBUFFåˆ°æœŸæ—¶è‡ªåŠ¨åˆ·æ–°
- **çŠ¶æ€ç»´æŒ**ï¼šç¡®ä¿å…³é”®çŠ¶æ€æŒç»­å­˜åœ¨

### èµ„æºæ¡ä»¶æ¨¡å¼ (ExecuteCondition = 2)
```json
{
  "name": "æ¶ˆè€—æŠ€èƒ½",
  "key": "r",
  "trigger_mode": 1,
  "execute_condition": 2,
  "condition_coord_x": 50,
  "condition_coord_y": 950,
  "condition_color": 0,  // 0=èµ„æºæ£€æµ‹, 1=HPæ£€æµ‹, å…¶ä»–=RGBé¢œè‰²åŒ¹é…
  "color_tolerance": 12,
  "alt_key": "t"
}
```

#### ğŸš€ äºŒæ¬¡ç¡®è®¤æœºåˆ¶ (æœ€æ–°æ¶æ„)
  èµ„æºæ¡ä»¶æ£€æµ‹é‡‡ç”¨æ™ºèƒ½çš„è¿ç»­æ€§éªŒè¯æœºåˆ¶ï¼Œç¡®ä¿æ£€æµ‹ç»“æœçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å®é™…ä»£ç ä¸­å®ç°äº†æ»‘åŠ¨çª—å£æ£€æµ‹ï¼Œé¿å…è¾¹ç•ŒæŠ–åŠ¨ï¼š

```python
def _check_resource_continuity(self, skill_name: str, current_result: bool) -> bool:
    """
    èµ„æºæ¡ä»¶è¿ç»­æ€§æ£€æŸ¥ - æ™ºèƒ½äºŒæ¬¡ç¡®è®¤æœºåˆ¶
    - å¦‚æœå½“å‰ç»“æœä¸ºTrueï¼ˆèµ„æºå……è¶³ï¼‰ï¼Œéœ€è¦è¿ç»­å¤šæ¬¡Trueæ‰æ‰§è¡Œä¸»æŒ‰é”®
    - å¦‚æœå½“å‰ç»“æœä¸ºFalseï¼ˆèµ„æºä¸è¶³ï¼‰ï¼Œç«‹å³æ‰§è¡Œå¤‡ç”¨æŒ‰é”®
    """
    history = self._resource_condition_history.setdefault(skill_name, [])
    history.append(current_result)
    if len(history) > self._required_consecutive_checks:  # é»˜è®¤ä¸º2
        history.pop(0)

    # å¦‚æœå½“å‰ç»“æœä¸ºFalseï¼ˆèµ„æºä¸è¶³ï¼‰ï¼Œç«‹å³è¿”å›Falseæ‰§è¡ŒAltKey
    if not current_result:
        return False

    # å¦‚æœå½“å‰ç»“æœä¸ºTrueï¼ˆèµ„æºå……è¶³ï¼‰ï¼Œéœ€è¦è¿ç»­å¤šæ¬¡Trueæ‰è¿”å›True
    if all(history) and len(history) == self._required_consecutive_checks:
        return True

    return False
```

**æ ¸å¿ƒè®¾è®¡åŸç†**ï¼š
- **èµ„æºä¸è¶³ï¼ˆFalseï¼‰**ï¼šç«‹å³å“åº”ï¼Œæ‰§è¡Œ `alt_key`ï¼Œé¿å…è¡¥ç»™å»¶è¿Ÿ
- **èµ„æºå……è¶³ï¼ˆTrueï¼‰**ï¼šéœ€è¦è¿ç»­2æ¬¡ç¡®è®¤ï¼Œæ‰§è¡Œ `key`ï¼Œé˜²æ­¢è¯¯åˆ¤æµªè´¹èµ„æº
- **æ»‘åŠ¨çª—å£**ï¼šä½¿ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶ï¼Œä¿æŒè¿ç»­æ€§æ£€æµ‹çš„å®æ—¶æ€§
- **ç‹¬ç«‹å†å²**ï¼šæ¯ä¸ªæŠ€èƒ½ç»´æŠ¤ç‹¬ç«‹çš„æ£€æµ‹å†å²è®°å½•

**é…ç½®å‚æ•°**ï¼š
- `_required_consecutive_checks = 2`ï¼šé»˜è®¤éœ€è¦è¿ç»­2æ¬¡Trueç¡®è®¤
- æ¯ä¸ªæŠ€èƒ½ç‹¬ç«‹è·Ÿè¸ªï¼š`_resource_condition_history = {skill_name: [å†å²ç»“æœ]}`

#### èµ„æºæ£€æµ‹ç±»å‹
| condition_color | æ£€æµ‹ç±»å‹ | è¯´æ˜ |
|-----------------|----------|------|
| 0 | èµ„æºå……è¶³æ€§ | é€šç”¨èµ„æºæ¡æ£€æµ‹ï¼ˆMPã€æ€’æ°”ã€èƒ½é‡ç­‰ï¼‰ |
| 1 | HPå……è¶³æ€§ | ä¸“ç”¨HPæ£€æµ‹ï¼Œé€‚é…ç”Ÿå‘½çƒç‰¹æ®Šå½¢çŠ¶ |
| å…¶ä»–RGBå€¼ | é¢œè‰²åŒ¹é… | ç²¾ç¡®çš„RGBé¢œè‰²ç›¸ä¼¼åº¦æ£€æµ‹ |

#### åŒæŒ‰é”®ç­–ç•¥
- **ä¸»æŒ‰é”®ï¼ˆkeyï¼‰**ï¼šèµ„æºå……è¶³ä¸”è¿ç»­ç¡®è®¤æ—¶ä½¿ç”¨çš„é«˜æ¶ˆè€—æŠ€èƒ½
- **å¤‡ç”¨æŒ‰é”®ï¼ˆalt_keyï¼‰**ï¼šèµ„æºä¸è¶³æ—¶ç«‹å³æ‰§è¡Œçš„ä½æ¶ˆè€—æ›¿ä»£æŠ€èƒ½  
- **æ™ºèƒ½åˆ‡æ¢**ï¼šæ ¹æ®å®æ—¶èµ„æºçŠ¶æ€å’ŒäºŒæ¬¡ç¡®è®¤ç»“æœè‡ªåŠ¨é€‰æ‹©

#### æ£€æµ‹é€»è¾‘æµç¨‹
```
1. è·å–ç¼“å­˜å¸§æ•°æ®
   â†“
2. æ ¹æ®condition_colorç±»å‹æ‰§è¡Œç›¸åº”æ£€æµ‹
   â†“
3. è°ƒç”¨_check_resource_continuity()è¿›è¡ŒäºŒæ¬¡ç¡®è®¤
   â†“
4. èµ„æºä¸è¶³ â†’ ç«‹å³è¿”å›False â†’ æ‰§è¡Œalt_key
   â†“
5. èµ„æºå……è¶³ â†’ æ£€æŸ¥è¿ç»­ç¡®è®¤ â†’ æ»¡è¶³æ¡ä»¶æ‰§è¡Œkey
```

---

## ğŸ”§ é«˜çº§é…ç½®æŠ€å·§

### 1. æŠ€èƒ½ä¼˜å…ˆçº§é…ç½®
```json
{
  "skills": [
    {
      "name": "ç´§æ€¥æ²»ç–—",
      "priority": "emergency",
      "execute_condition": 2,
      "resource_type": "hp",
      "resource_threshold": 30
    },
    {
      "name": "ä¸»è¦è¾“å‡º",
      "priority": "high",
      "execute_condition": 1,
      "buff_coords": [300, 100, 40, 40]
    },
    {
      "name": "è¾…åŠ©æŠ€èƒ½",
      "priority": "normal",
      "execute_condition": 0
    },
    {
      "name": "æ‹¾å–ç‰©å“",
      "priority": "low",
      "execute_condition": 0
    }
  ]
}
```

#### ä¼˜å…ˆçº§ç­‰çº§è¯´æ˜
- **emergency**ï¼šç´§æ€¥ä¼˜å…ˆçº§ï¼Œç”¨äºHP/MPè¯å‰‚ç­‰å…³é”®æ“ä½œ
- **high**ï¼šé«˜ä¼˜å…ˆçº§ï¼Œç”¨äºæ ¸å¿ƒè¾“å‡ºå’Œé‡è¦BUFFæŠ€èƒ½
- **normal**ï¼šæ™®é€šä¼˜å…ˆçº§ï¼Œç”¨äºå¸¸è§„æ”»å‡»æŠ€èƒ½
- **low**ï¼šä½ä¼˜å…ˆçº§ï¼Œç”¨äºè¾…åŠ©åŠŸèƒ½å’Œç•Œé¢æ“ä½œ

### 2. æ¡ä»¶ç»„åˆç­–ç•¥
```json
{
  "name": "å¤åˆæ¡ä»¶æŠ€èƒ½",
  "key": "q",
  "execute_condition": 2,
  "resource_coords": [50, 950, 200, 20],
  "resource_threshold": 80,
  "additional_conditions": {
    "buff_check": {
      "coords": [200, 100, 30, 30],
      "required": false
    },
    "enemy_presence": {
      "coords": [500, 400, 100, 100],
      "required": true
    }
  }
}
```

### 3. ç¯å¢ƒé€‚é…é…ç½®
```json
{
  "profiles": {
    "1920x1080": {
      "hp_region": [136, 910, 213, 1004],
      "mp_region": [136, 870, 213, 894],
      "skill_size": 20
    },
    "2560x1440": {
      "hp_region": [181, 1213, 284, 1339],
      "mp_region": [181, 1160, 284, 1192],
      "skill_size": 27
    }
  }
}
```

### 4. ä¼˜å…ˆçº§æŒ‰é”®é…ç½®ï¼ˆé€‰æ‹©æ€§äº‹ä»¶æ‹¦æˆªï¼‰
```json
{
  "priority_keys": {
    "enabled": true,
    "special_keys": ["space"],
    "managed_keys": {
      "right_mouse": { "target": "right_mouse", "delay": 50 },
      "e": { "target": "0", "delay": 30 }
    },
    "description": "special_keys ä»…ç›‘æ§ä¸æ‹¦æˆªï¼›managed_keys é‡‡ç”¨å¯¹è±¡æ ¼å¼ï¼Œæ”¯æŒæ˜ å°„ä¸å‰ç½®å»¶è¿Ÿ"
  }
}
```

#### é…ç½®è¯´æ˜ï¼ˆæ–°æ ¼å¼ï¼‰
- special_keysï¼šä»…ç”¨äºçŠ¶æ€ç›‘æ§ä¸æš‚åœï¼Œä¸æ‹¦æˆªç³»ç»Ÿäº‹ä»¶ï¼Œä¸éœ€è¦ target/delay
- managed_keysï¼šå¯¹è±¡æ ¼å¼ï¼Œé”®ä¸ºè¢«â€œç®¡ç†â€çš„ç‰©ç†æŒ‰é”®åï¼Œå€¼ä¸ºå¯¹è±¡ï¼š
  - targetï¼šæœ€ç»ˆå‘é€åˆ°æ¸¸æˆçš„æŒ‰é”®ï¼ˆä¸ºé¿å…è‡ªæ‹¦æˆªï¼Œæ‹¦æˆª E â†’ å‘é€ 0 ç­‰æ˜ å°„æ›´ç¨³å¥ï¼‰
  - delayï¼šå‰ç½®å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ï¼Œç”¨äºâ€œæš‚åœâ†’çŠ¶æ€åŒæ­¥â†’å‘é€â€å¯é æ—¶åº

#### é…ç½®è¯´æ˜
- **enabled**ï¼šæ˜¯å¦å¯ç”¨ä¼˜å…ˆçº§æŒ‰é”®ç³»ç»Ÿ
- **keys**ï¼šä¼˜å…ˆçº§æŒ‰é”®åˆ—è¡¨ï¼Œæ”¯æŒå¤šç§æŒ‰é”®åç§°å˜ä½“
- **description**ï¼šé…ç½®æè¿°ï¼ˆå¯é€‰ï¼‰

#### æ”¯æŒçš„æŒ‰é”®ç±»å‹
- **é”®ç›˜æŒ‰é”®**ï¼š`space`, `ctrl`, `shift`, `alt`, `tab`, `enter`, `esc`, `a-z`, `0-9`, `f1-f12`
- **é¼ æ ‡æŒ‰é”®**ï¼š`left_mouse`, `right_mouse`, `middle_mouse`
- **æŒ‰é”®æ ‡å‡†åŒ–**ï¼šè‡ªåŠ¨å¤„ç†å˜ä½“ï¼ˆå¦‚ `spacebar` â†’ `space`ï¼‰

#### éªŒè¯è§„åˆ™è¡¥å……ï¼ˆå»ºè®®ï¼‰
- managed_keys çš„å€¼é¡»å½¢å¦‚ {"target": string, "delay": int>=0}
- è‹¥ target ä¸è¢«æ‹¦æˆªé”®ç›¸åŒï¼Œåº•å±‚ Hook å¯èƒ½è‡ªæ‹¦æˆªå¯¼è‡´æ— æ•ˆï¼Œå»ºè®®åœ¨ GUI ä¸­ç»™å‡ºæç¤ºå¹¶å¼•å¯¼æ˜ å°„

### 5. æ™ºèƒ½è¯å‰‚æ£€æµ‹é…ç½®

#### çŸ©å½¢æ£€æµ‹é…ç½®ï¼ˆæ¨è â­ï¼‰
```json
{
  "resource_management": {
    "hp_config": {
      "enabled": true,
      "key": "1",
      "threshold": 50,
      "detection_mode": "rectangle",
      "region_x1": 113,
      "region_y1": 896,
      "region_x2": 124,
      "region_y2": 1051,
      "tolerance_h": 10,
      "tolerance_s": 30,
      "tolerance_v": 50
    }
  }
}
```

**é…ç½®è¯´æ˜**ï¼š
- `detection_mode`: "rectangle" - ä½¿ç”¨çŸ©å½¢æ£€æµ‹ï¼ˆ0.3msï¼Œ100%æˆåŠŸç‡ï¼‰
- `region_x1/y1/x2/y2`: HP/MPæ¡çš„çŸ©å½¢åŒºåŸŸåæ ‡
- `tolerance_h/s/v`: HSVå®¹å·®å‚æ•°ï¼ˆå¯è°ƒæ•´ä»¥é€‚åº”ä¸åŒå…‰ç…§ï¼‰
- ä½¿ç”¨å‰éœ€æŒ‰F8é”®åˆå§‹åŒ–æ¨¡æ¿ï¼ˆæ»¡è¡€æ»¡è“çŠ¶æ€ï¼‰

#### åœ†å½¢æ£€æµ‹é…ç½®
```json
{
  "resource_management": {
    "hp_config": {
      "enabled": true,
      "key": "1",
      "threshold": 50,
      "detection_mode": "circle",
      "center_x": 175,
      "center_y": 957,
      "radius": 39,
      "colors": [
        {
          "name": "HP Normal",
          "target_h": 157,
          "target_s": 75,
          "target_v": 29,
          "tolerance_h": 5,
          "tolerance_s": 20,
          "tolerance_v": 20
        }
      ]
    }
  }
}
```

#### æ–‡æœ¬OCRæ£€æµ‹é…ç½®ï¼ˆæœ€æ–°åŠŸèƒ½ï¼‰
```json
{
  "resource_management": {
    "mp_config": {
      "enabled": true,
      "key": "2",
      "threshold": 50,
      "detection_mode": "text_ocr",
      "text_x1": 1552,
      "text_y1": 910,
      "text_x2": 1560,
      "text_y2": 1004,
      "match_threshold": 0.70
    }
  }
}
```

#### æ£€æµ‹æ¨¡å¼å¯¹æ¯”ï¼ˆå®æµ‹478æ¬¡ï¼‰

| æ£€æµ‹æ¨¡å¼ | æ€§èƒ½ | æˆåŠŸç‡ | å‡†ç¡®ç‡ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|----------|------|--------|--------|----------|--------|
| **rectangle** â­ | 0.3ms | 100% | 96%è¯¯å·®<5% | æ¡å½¢èµ„æºæ¡ | â­â­â­â­â­ |
| **circle** | ~5ms | 99%+ | 95%+ | çƒå½¢èµ„æºæ¡ | â­â­â­â­ |
| **text_ocr** | 25-241ms | 98-99% | 90-100% | æ•°å­—æ–‡æœ¬ | â­â­ |

#### çŸ©å½¢æ£€æµ‹ä¼˜åŠ¿ï¼ˆæ¨è â­ï¼‰
- **æ€§èƒ½æœ€ä½³**ï¼š0.3msï¼Œæ¯”OCRå¿«82-803å€
- **æˆåŠŸç‡æœ€é«˜**ï¼š100%ï¼Œæ— è¯†åˆ«å¤±è´¥æƒ…å†µ
- **å‡†ç¡®ç‡é«˜**ï¼š96%è¯¯å·®<5%ï¼Œ98.5%è¯¯å·®<10%
- **å¯é æ€§å¼º**ï¼šåœ¨OCRé”™è¯¯æ—¶ä»èƒ½ç»™å‡ºåˆç†å€¼
- **è‡ªé€‚åº”**ï¼šæŒ‰F8è‡ªåŠ¨é€‚åº”ä¸åŒç¯å¢ƒå’Œå…‰ç…§
- **é…ç½®ç®€å•**ï¼šåªéœ€è®¾ç½®åŒºåŸŸåæ ‡å’ŒHSVå®¹å·®

#### åœ†å½¢æ£€æµ‹ä¼˜åŠ¿
- **ç²¾ç¡®åº¦æ›´é«˜**ï¼šåªæ£€æµ‹çƒä½“åŒºåŸŸï¼Œæ’é™¤èƒŒæ™¯å¹²æ‰°
- **è‡ªåŠ¨è¯†åˆ«**ï¼šæ”¯æŒ"Detect Orbs"æŒ‰é’®è‡ªåŠ¨è¯†åˆ«çƒä½“ä½ç½®
- **æŠ—å¹²æ‰°å¼º**ï¼šåœ†å½¢è’™ç‰ˆç¡®ä¿åªè®¡ç®—çƒä½“å†…çš„åƒç´ 
- **æ€§èƒ½è‰¯å¥½**ï¼š~5msï¼Œæ¯”OCRå¿«5-48å€

#### æ–‡æœ¬OCRæ£€æµ‹ç‰¹ç‚¹
- **ç›´æ¥è¯»æ•°**ï¼šè¯†åˆ«å®é™…çš„HP/MPæ•°å€¼ï¼Œæ— éœ€ä¼°ç®—
- **é€šç”¨æ€§å¼º**ï¼šé€‚ç”¨äºåªæ˜¾ç¤ºæ•°å­—çš„UI
- **æ€§èƒ½è¾ƒæ…¢**ï¼š25-241msï¼Œæ¯”çŸ©å½¢æ£€æµ‹æ…¢82-803å€
- **æœ‰å¤±è´¥æ¡ˆä¾‹**ï¼šå®æµ‹478æ¬¡ä¸­æœ‰8ä¸ªè¯†åˆ«é”™è¯¯ï¼ˆç™¾åˆ†æ¯”>100%ï¼‰
- **å»ºè®®**ï¼šä»…åœ¨æ— æ³•ä½¿ç”¨çŸ©å½¢/åœ†å½¢æ£€æµ‹æ—¶ä½¿ç”¨

#### HSVå®¹å·®å‚æ•°è°ƒä¼˜

çŸ©å½¢æ£€æµ‹ä½¿ç”¨HSVé¢œè‰²ç©ºé—´è¿›è¡Œæ¨¡æ¿åŒ¹é…ï¼Œå®¹å·®å‚æ•°å†³å®šäº†åŒ¹é…çš„å®½æ¾ç¨‹åº¦ï¼š

```json
{
  "tolerance_h": 10,  // Hå€¼ï¼ˆè‰²è°ƒï¼‰å®¹å·®ï¼ŒèŒƒå›´0-179
  "tolerance_s": 30,  // Så€¼ï¼ˆé¥±å’Œåº¦ï¼‰å®¹å·®ï¼ŒèŒƒå›´0-255
  "tolerance_v": 50   // Vå€¼ï¼ˆæ˜åº¦ï¼‰å®¹å·®ï¼ŒèŒƒå›´0-255
}
```

**è°ƒä¼˜å»ºè®®**ï¼š
- **Hå€¼å®¹å·®**ï¼šæ§åˆ¶é¢œè‰²åŒ¹é…èŒƒå›´ï¼Œé»˜è®¤10é€‚åˆå¤§å¤šæ•°æƒ…å†µ
- **Så€¼å®¹å·®**ï¼šæ§åˆ¶é¥±å’Œåº¦å®¹å¿åº¦ï¼Œå…‰ç…§å˜åŒ–å¤§æ—¶å¯é€‚å½“å¢åŠ 
- **Vå€¼å®¹å·®**ï¼šæ§åˆ¶æ˜åº¦å®¹å¿åº¦ï¼Œé»˜è®¤50å¯åº”å¯¹å¤§éƒ¨åˆ†å…‰ç…§å˜åŒ–
- **æµ‹è¯•æ–¹æ³•**ï¼šè¿è¡Œ`python performance_test/perf_full_benchmark.py`éªŒè¯æ•ˆæœ

**å¸¸è§é—®é¢˜**ï¼š
- è¯¯å·®è¿‡å¤§ï¼ˆ>10%ï¼‰ï¼šå‡å°å®¹å·®å€¼ï¼Œç‰¹åˆ«æ˜¯Vå€¼
- æ£€æµ‹å¤±è´¥ï¼šå¢å¤§å®¹å·®å€¼ï¼Œæˆ–é‡æ–°æŒ‰F8åˆå§‹åŒ–æ¨¡æ¿
- å…‰ç…§å˜åŒ–å½±å“å¤§ï¼šå¢å¤§Vå€¼å®¹å·®

### 6. è°ƒè¯•é…ç½®
```json
{
  "debug": {
    "enabled": true,
    "log_conditions": true,
    "log_resource_detection": true,
    "log_priority_keys": true,
    "log_event_interception": true,
    "save_detection_frames": false,
    "condition_log_interval": 1000
  }
}
```

---

## ğŸ”„ é…ç½®æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼é…ç½®
```python
# ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æŠ€èƒ½é…ç½®
basic_skills = [
    {"name": "æ”»å‡»", "key": "1", "trigger_mode": 0, "execute_condition": 0}
]

# ç¬¬äºŒé˜¶æ®µï¼šæ·»åŠ å†·å´æ£€æµ‹
advanced_skills = [
    {"name": "æ”»å‡»", "key": "1", "trigger_mode": 1, "execute_condition": 0,
     "cooldown_coords": [100, 50, 20, 20]}
]

# ç¬¬ä¸‰é˜¶æ®µï¼šæ·»åŠ å¤æ‚æ¡ä»¶
expert_skills = [
    {"name": "æ”»å‡»", "key": "1", "trigger_mode": 1, "execute_condition": 2,
     "cooldown_coords": [100, 50, 20, 20],
     "resource_coords": [50, 950, 200, 20],
     "resource_threshold": 70}
]
```

### 2. é…ç½®æ¨¡æ¿
```json
{
  "templates": {
    "basic_skill": {
      "trigger_mode": 1,
      "execute_condition": 0,
      "priority": "normal",
      "enabled": true
    },
    "high_priority_skill": {
      "trigger_mode": 1,
      "execute_condition": 0,
      "priority": "high",
      "enabled": true
    },
    "emergency_skill": {
      "trigger_mode": 1,
      "execute_condition": 0,
      "priority": "emergency",
      "enabled": true
    },
    "resource_skill": {
      "trigger_mode": 1,
      "execute_condition": 2,
      "resource_threshold": 70,
      "continuity_window": 3,
      "continuity_threshold": 2,
      "priority": "normal"
    },
    "buff_skill": {
      "trigger_mode": 1,
      "execute_condition": 1,
      "buff_tolerance": 20,
      "priority": "high"
    },
    "circular_hp_potion": {
      "enabled": true,
      "threshold": 50,
      "center_x": 175,
      "center_y": 957,
      "radius": 39,
      "colors": [
        {
          "name": "HP Normal",
          "target_h": 157,
          "target_s": 75,
          "target_v": 29,
          "tolerance_h": 5,
          "tolerance_s": 20,
          "tolerance_v": 20
        }
      ]
    },
    "rectangular_mp_potion": {
      "enabled": true,
      "threshold": 50,
      "region_x1": 1552,
      "region_y1": 910,
      "region_x2": 1560,
      "region_y2": 1004,
      "colors": [
        {
          "name": "MP Normal",
          "target_h": 104,
          "target_s": 80,
          "target_v": 58,
          "tolerance_h": 4,
          "tolerance_s": 5,
          "tolerance_v": 5
        }
      ]
    }
  }
}
```

### 3. é…ç½®éªŒè¯
```python
def validate_skill_config(skill_config):
    """é…ç½®éªŒè¯å‡½æ•°"""
    errors = []

    # å¿…éœ€å­—æ®µæ£€æŸ¥
    required_fields = ["name", "key", "trigger_mode"]
    for field in required_fields:
        if field not in skill_config:
            errors.append(f"ç¼ºå°‘å¿…éœ€å­—æ®µ: {field}")

    # ä¼˜å…ˆçº§éªŒè¯
    priority = skill_config.get("priority", "normal")
    valid_priorities = ["emergency", "high", "normal", "low"]
    if priority not in valid_priorities:
        errors.append(f"æ— æ•ˆçš„ä¼˜å…ˆçº§: {priority}ï¼Œåº”ä¸º: {valid_priorities}")

    # æ¡ä»¶ç‰¹å®šéªŒè¯
    execute_condition = skill_config.get("execute_condition", 0)
    if execute_condition == 1:  # BUFFæ¡ä»¶
        if not skill_config.get("buff_coords"):
            errors.append("BUFFæ¡ä»¶æ¨¡å¼éœ€è¦é…ç½®buff_coords")
    elif execute_condition == 2:  # èµ„æºæ¡ä»¶
        if not skill_config.get("resource_coords"):
            errors.append("èµ„æºæ¡ä»¶æ¨¡å¼éœ€è¦é…ç½®resource_coords")

    return errors

def validate_resource_config(resource_config):
    """æ™ºèƒ½è¯å‰‚é…ç½®éªŒè¯"""
    errors = []

    # æ£€æŸ¥æ˜¯å¦è‡³å°‘é…ç½®äº†çŸ©å½¢æˆ–åœ†å½¢æ£€æµ‹æ–¹å¼
    has_rect_config = all(k in resource_config for k in ["region_x1", "region_y1", "region_x2", "region_y2"])
    has_circle_config = all(k in resource_config for k in ["center_x", "center_y", "radius"])

    if not has_rect_config and not has_circle_config:
        errors.append("éœ€è¦é…ç½®çŸ©å½¢æ£€æµ‹åŒºåŸŸæˆ–åœ†å½¢æ£€æµ‹å‚æ•°")

    # é¢œè‰²é…ç½®éªŒè¯
    colors = resource_config.get("colors", [])
    if not colors:
        errors.append("è‡³å°‘éœ€è¦é…ç½®ä¸€ç§é¢œè‰²ç”¨äºæ£€æµ‹")

    for i, color in enumerate(colors):
        required_fields = ["target_h", "target_s", "target_v", "tolerance_h", "tolerance_s", "tolerance_v"]
        for field in required_fields:
            if field not in color:
                errors.append(f"é¢œè‰²{i+1}ç¼ºå°‘å­—æ®µ: {field}")

    return errors

def validate_priority_keys_config(config):
    """ä¼˜å…ˆçº§æŒ‰é”®é…ç½®éªŒè¯ï¼ˆæ”¯æŒé€‰æ‹©æ€§äº‹ä»¶æ‹¦æˆªï¼‰"""
    errors = []

    if not isinstance(config.get("enabled"), bool):
        errors.append("enabledå­—æ®µå¿…é¡»ä¸ºå¸ƒå°”å€¼")

    keys = config.get("keys", [])
    if not isinstance(keys, list):
        errors.append("keyså­—æ®µå¿…é¡»ä¸ºæ•°ç»„")

    # éªŒè¯delay_msé…ç½®
    delay_ms = config.get("delay_ms", 50)
    if not isinstance(delay_ms, int) or delay_ms < 0 or delay_ms > 1000:
        errors.append("delay_mså¿…é¡»ä¸º0-1000ä¹‹é—´çš„æ•´æ•°")

    # éªŒè¯special_keysé…ç½®
    special_keys = config.get("special_keys", [])
    if not isinstance(special_keys, list):
        errors.append("special_keyså­—æ®µå¿…é¡»ä¸ºæ•°ç»„")
    
    # ç¡®ä¿special_keyséƒ½åœ¨keysä¸­
    for special_key in special_keys:
        if special_key not in keys:
            errors.append(f"special_key '{special_key}' å¿…é¡»åœ¨keysåˆ—è¡¨ä¸­")

    # æ ‡å‡†åŒ–æŒ‰é”®åç§°æ£€æŸ¥
    valid_key_patterns = [
        r'^[a-zA-Z0-9]$',  # å•å­—æ¯æ•°å­—
        r'^f[0-9]{1,2}$',  # F1-F12
        r'^(ctrl|shift|alt|space|tab|enter|esc)$',  # ç‰¹æ®Šé”®
        r'^(left_mouse|right_mouse|middle_mouse)$'  # é¼ æ ‡é”®
    ]

    import re
    for key in keys:
        if not any(re.match(pattern, key) for pattern in valid_key_patterns):
            errors.append(f"æ— æ•ˆçš„æŒ‰é”®åç§°: {key}")

    return errors
```

é€šè¿‡è¿™å¥—å®Œæ•´çš„é…ç½®å’Œæ¡ä»¶ç³»ç»Ÿï¼Œpyahkèƒ½å¤Ÿé€‚åº”å„ç§å¤æ‚çš„æ¸¸æˆåœºæ™¯å’Œç”¨æˆ·éœ€æ±‚ï¼Œæä¾›ç²¾ç¡®çš„è‡ªåŠ¨åŒ–æ§åˆ¶èƒ½åŠ›ã€‚